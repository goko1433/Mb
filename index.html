<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Merkez Bankasƒ±</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
    :root {
      --primary-bg: #f4f7fa;
      --panel-bg: #ffffff;
      --header-bg: #0d1b2a;
      --text-color: #333;
      --text-muted: #6c757d;
      --accent-color: #ffc107;
      --green: #28a745;
      --red: #dc3545;
      --blue: #007bff;
      --purple: #6f42c1;
      --shadow: 0 6px 15px rgba(0,0,0,0.07);
      --gold-color: #FFD700; /* Altƒ±n rengi */
    }

    /* Dark Mode Variables */
    body.dark-mode {
      --primary-bg: #1a202c;
      --panel-bg: #2d3748;
      --header-bg: #4a5568;
      --text-color: #e2e8f0;
      --text-muted: #a0aec0;
      --shadow: 0 6px 15px rgba(0,0,0,0.3);
      --trade-log-bg: #1a202c;
      --trade-log-border: #4a5568;
      --tweet-feed-bg: #2d3748;
      --tweet-feed-border: #4a5568;
      --input-border: #4a5568;
      --input-bg: #4a5568;
      --input-text: #e2e8f0;
      --stat-bg: #2d3748;
      --stat-border: #4a5568;
    }

    body.dark-mode .header {
      background: linear-gradient(45deg, #4a5568, #2d3748);
      border-bottom-color: var(--accent-color);
    }

    body.dark-mode .stat {
      background: var(--stat-bg);
      border: 1px solid var(--stat-border);
    }

    body.dark-mode .stat-value {
      color: var(--text-color);
    }

    body.dark-mode #hukumet-guveni-bar {
      background-color: var(--stat-border);
    }

    body.dark-mode .control-group {
      background: var(--stat-bg);
      border: 1px solid var(--stat-border);
    }

    body.dark-mode h3 {
      color: var(--text-color);
      border-bottom-color: var(--stat-border);
    }

    body.dark-mode input[type="number"],
    body.dark-mode input[type="range"],
    body.dark-mode input[type="text"],
    body.dark-mode input[type="password"],
    body.dark-mode textarea {
      border: 1px solid var(--input-border);
      background-color: var(--input-bg);
      color: var(--input-text);
    }

    body.dark-mode #trade-log {
      background-color: var(--trade-log-bg);
      border: 1px solid var(--trade-log-border);
    }

    body.dark-mode .trade-item {
      border-bottom-color: var(--trade-log-border);
    }

    body.dark-mode #tweet-feed {
      background-color: var(--tweet-feed-bg);
      border: 1px solid var(--tweet-feed-border);
    }

    body.dark-mode .tweet-item {
      border-bottom-color: var(--tweet-feed-border);
    }

    body.dark-mode .modal-content {
      background: var(--panel-bg);
      color: var(--text-color);
    }

    body.dark-mode .modal-content h1,
    body.dark-mode .modal-content h2 {
      color: var(--text-color);
    }

    body.dark-mode .report-item {
      background: var(--stat-bg);
    }

    body.dark-mode .crypto-item {
      border-bottom-color: var(--stat-border);
    }

    body.dark-mode .crypto-name {
      color: var(--text-color);
    }

    body.dark-mode .crypto-chart-container {
      background-color: var(--stat-border);
    }

    * { box-sizing: border-box; }
    body {
      font-family: 'Roboto', sans-serif;
      background-color: var(--primary-bg);
      color: var(--text-color);
      margin: 0;
      padding: 0;
      font-size: 16px;
      -webkit-tap-highlight-color: transparent;
      overscroll-behavior: none;
    }
    .container { width: 100%; max-width: 1200px; margin: 10px auto; padding: 0 10px; }
    .content-wrapper { background: var(--panel-bg); box-shadow: var(--shadow); padding: 15px; border-radius: 12px; }
    .header {
      background: linear-gradient(45deg, #0d1b2a, #1b263b);
      color: white;
      padding: 15px;
      text-align: center;
      font-size: 20px;
      font-weight: 700;
      border-bottom: 4px solid var(--accent-color);
      border-radius: 12px 12px 0 0;
      letter-spacing: 0.5px;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .header .title {
      font-size: 20px;
      margin-bottom: 5px;
    }
    .header .datetime {
      font-size: 14px;
      color: var(--accent-color);
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
      margin-bottom: 15px;
    }
    .stat {
      background: #f8f9fa;
      padding: 8px;
      border-radius: 8px;
      text-align: center;
      border: 1px solid #e9ecef;
      transition: all 0.2s ease-in-out;
    }
    .stat-label {
      font-size: 12px;
      font-weight: 500;
      color: var(--text-muted);
      margin-bottom: 5px;
      cursor: help;
    }
    .stat-value {
      font-size: 18px;
      font-weight: 700;
      color: var(--header-bg);
    }
    .stat-value.positive { color: var(--green); }
    .stat-value.negative { color: var(--red); }
    .stat-value.gold { color: var(--gold-color); } /* Altƒ±n rengi i√ßin yeni sƒ±nƒ±f */

    #hukumet-guveni-bar {
      width: 100%;
      background-color: #e9ecef;
      border-radius: 4px;
      overflow: hidden;
      height: 8px;
      margin-top: 4px;
    }
    #hukumet-guveni-bar-inner {
      height: 100%;
      width: 50%;
      background-color: var(--purple);
      transition: width 0.5s ease-in-out, background-color 0.5s;
    }
    @keyframes flash-green { 0%, 100% { background-color: #f8f9fa; } 50% { background-color: rgba(40, 167, 69, 0.3); } }
    @keyframes flash-red { 0%, 100% { background-color: #f8f9fa; } 50% { background-color: rgba(220, 53, 69, 0.3); } }
    .flash-green { animation: flash-green 1s ease-out; }
    .flash-red { animation: flash-red 1s ease-out; }
    .main-content {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .chart-container {
      min-height: 300px;
      width: 100%;
    }
    .controls-container {
      display: grid;
      grid-template-columns: 1fr;
      gap: 15px;
    }
    .control-group {
      background: #f8f9fa;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #e9ecef;
    }
    h3 {
      margin: 0 0 10px;
      font-size: 14px;
      color: var(--header-bg);
      border-bottom: 2px solid #e9ecef;
      padding-bottom: 5px;
    }
    .input-group {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
      align-items: center;
      flex-wrap: wrap;
    }
    input[type="number"], input[type="range"], input[type="text"], input[type="password"], textarea {
      width: 100%;
      max-width: 150px;
      padding: 6px;
      border: 1px solid #ced4da;
      border-radius: 4px;
      font-size: 14px;
      -webkit-appearance: none;
      appearance: none;
    }
    textarea {
        max-width: 100%;
        min-height: 60px;
        resize: vertical;
    }
    input[type="number"]::-webkit-inner-spin-button, input[type="number"]::-webkit-outer-spin-button {
      opacity: 1;
    }
    input[type="range"] {
      cursor: pointer;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      background: var(--blue);
      border-radius: 50%;
      border: 1px solid #ced4da;
    }
    button {
      flex: 1;
      min-width: 100px;
      padding: 8px;
      font-size: 13px;
      font-weight: bold;
      cursor: pointer;
      border: none;
      border-radius: 6px;
      color: white;
      transition: all 0.2s;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      touch-action: manipulation;
    }
    button:disabled {
      background-color: #adb5bd !important;
      cursor: not-allowed;
      opacity: 0.6;
      box-shadow: none;
    }
    button:hover:not(:disabled) {
      opacity: 0.9;
      transform: translateY(-1px);
      box-shadow: 0 3px 8px rgba(0,0,0,0.15);
    }
    .btn-sell { background-color: var(--red); }
    .btn-buy { background-color: var(--green); }
    .btn-primary { background-color: var(--blue); }
    .btn-secondary { background-color: var(--text-muted); }
    .btn-purple { background-color: var(--purple); }
    .trade-log-container {
      margin-top: 15px;
    }
    #trade-log {
      background-color: #17212b;
      color: #f8f9fa;
      height: 150px;
      overflow-y: auto;
      padding: 8px;
      border-radius: 8px;
      font-family: 'Courier New', Courier, monospace;
      font-size: 11px;
      list-style: none;
      margin: 0;
    }
    .trade-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 4px;
      border-bottom: 1px solid #2a3b4c;
      flex-wrap: wrap;
    }
    .log-group-1 { flex-basis: 35%; }
    .log-group-2 { flex-basis: 30%; justify-content: center; text-align: center; }
    .log-group-3 { flex-basis: 35%; justify-content: flex-end; text-align: right; }
    .log-time { color: #adb5bd; margin-right: 5px; }
    .log-actor { color: #e9ecef; font-weight: 500; }
    .log-type { font-weight: bold; width: 50px; text-align: center; padding: 2px 4px; border-radius: 3px; }
    .log-amount { color: #f8f9fa; width: 80px; text-align: right; }
    .log-rate-label { color: var(--text-muted); margin-right: 3px; }
    .log-rate { color: var(--accent-color); font-weight: bold; }
    .trade-buy .log-type { color: var(--green); }
    .trade-sell .log-type { color: var(--red); }
    .trade-intervention { background-color: rgba(255, 193, 7, 0.1); border-left: 2px solid var(--accent-color); }
    .trade-intervention .log-actor { color: var(--accent-color); font-weight: bold; }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(13, 27, 42, 0.9);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      text-align: center;
      color: white;
      padding: 10px;
      overflow-y: auto;
    }
    .modal-content {
      background: var(--panel-bg);
      color: var(--text-color);
      padding: 20px;
      border-radius: 12px;
      max-width: 90%;
      width: 500px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.5);
    }
    .modal-content h1 { font-size: 24px; color: var(--header-bg); margin-bottom: 8px; }
    .modal-content h2 { font-size: 18px; color: var(--header-bg); margin-bottom: 15px; }
    .modal-content p { font-size: 14px; margin-bottom: 20px; }
    .modal-buttons { display: flex; flex-direction: column; gap: 10px; }
    .grade { font-size: 18px; font-weight: bold; padding: 4px 8px; border-radius: 6px; color: white; }
    .grade-A { background-color: var(--green); }
    .grade-B { background-color: #20c997; }
    .grade-C { background-color: var(--accent-color); color: #333; }
    .grade-D { background-color: #fd7e14; }
    .grade-F { background-color: var(--red); }
    .report-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
      text-align: left;
      margin-bottom: 15px;
    }
    .report-item {
      background: #f8f9fa;
      padding: 10px;
      border-radius: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .report-item span:first-child { font-weight: 500; }
    .report-item span:last-child { font-weight: bold; }
    .news-ticker {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background-color: var(--header-bg);
      color: white;
      padding: 8px 0;
      z-index: 1000;
      overflow: hidden;
      white-space: nowrap;
      font-size: 14px;
    }
    .news-content {
      display: inline-block;
      padding-left: 100%;
      animation: ticker-scroll 25s linear infinite;
    }
    .news-content span { margin: 0 30px; }
    .news-item-red { color: var(--red); }
    .news-item-green { color: var(--green); }
    .news-ticker:hover .news-content { animation-play-state: paused; }
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--green);
      color: white;
      padding: 10px 20px;
      border-radius: 6px;
      box-shadow: var(--shadow);
      opacity: 0;
      transition: opacity 0.3s, transform 0.3s;
      z-index: 1500;
      transform: translateX(110%);
    }
    .notification.show { opacity: 1; transform: translateX(0); }
    .notification.error { background: var(--red); }
    @keyframes ticker-scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

    /* Kripto Piyasasƒ± Stilleri */
    .crypto-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px dashed #e9ecef;
      font-size: 14px;
      flex-wrap: wrap;
    }
    .crypto-item:last-child {
      border-bottom: none;
    }
    .crypto-info {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    .crypto-name {
      font-weight: bold;
      color: var(--header-bg);
      margin-bottom: 2px;
    }
    .crypto-price {
      font-size: 13px;
      color: var(--text-color);
    }
    .crypto-actions {
      display: flex;
      gap: 5px;
      align-items: center;
      margin-top: 5px;
      flex-basis: 100%;
      justify-content: flex-end;
    }
    .crypto-actions input[type="number"] {
      width: 70px;
      max-width: 70px;
      text-align: center;
      padding: 4px;
      font-size: 12px;
    }
    .crypto-actions button {
      padding: 4px 8px;
      font-size: 11px;
      min-width: 45px;
    }
    .crypto-chart-container {
      width: 100%;
      height: 80px;
      margin-top: 5px;
      background-color: #f0f2f5;
      border-radius: 4px;
      padding: 5px;
    }

    /* Sosyal Medya Stilleri */
    .social-media-feed-container {
      margin-top: 15px;
    }
    #tweet-feed {
      background-color: #e6ecf0;
      color: #333;
      height: 200px;
      overflow-y: auto;
      padding: 10px;
      border-radius: 8px;
      font-family: 'Roboto', sans-serif;
      font-size: 13px;
      list-style: none;
      margin: 0;
      border: 1px solid #ddd;
    }
    .tweet-item {
      padding: 8px 0;
      border-bottom: 1px solid #c0d3e5;
      display: flex;
      flex-direction: column;
    }
    .tweet-item:last-child {
      border-bottom: none;
    }
    .tweet-meta {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      color: #657786;
      margin-bottom: 4px;
    }
    .tweet-user {
      font-weight: bold;
      color: #1da1f2;
    }
    .tweet-text {
      line-height: 1.4;
      word-wrap: break-word;
    }
    .tweet-positive {
      color: var(--green);
    }
    .tweet-negative {
      color: var(--red);
    }
    .tweet-neutral {
      color: var(--text-color);
    }

    /* Danƒ±≈üman Modalƒ± i√ßin √∂zel stil */
    #advisor-modal .modal-content {
      max-width: 600px;
    }
    #advisor-text {
      margin-bottom: 20px;
      line-height: 1.6;
      font-size: 15px;
      text-align: left;
    }
    #advisor-suggestions { display: flex; flex-direction: column; gap: 10px; }
    #advisor-suggestions button {
      text-align: left;
      justify-content: flex-start;
      padding: 10px;
      font-size: 14px;
    }
    #advisor-suggestions button strong {
      display: block;
      margin-bottom: 5px;
      font-size: 15px;
    }
    #advisor-suggestions button small {
      font-size: 11px;
      color: rgba(255,255,255,0.8);
      line-height: 1.3;
    }
    .grid-2-col {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
    }

    /* Login/Signup Modal */
    #auth-modal .modal-content {
      max-width: 400px;
    }
    .auth-form {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .auth-form .input-group {
      flex-direction: column;
      align-items: stretch;
    }
    .auth-form label {
      font-size: 14px;
      margin-bottom: 5px;
      display: block;
    }
    .auth-form input[type="text"],
    .auth-form input[type="password"] {
      max-width: 100%;
    }
    .auth-switch {
      margin-top: 10px;
      font-size: 13px;
      text-align: center;
    }
    .auth-switch a {
      color: var(--blue);
      cursor: pointer;
      text-decoration: underline;
    }

    /* AFK Summary Modal */
    #afk-summary-modal .modal-content {
      max-width: 600px;
    }
    .summary-item {
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }
    .summary-item:last-child {
      border-bottom: none;
    }
    .summary-item .label {
      font-weight: 500;
      margin-bottom: 5px;
    }
    .summary-item .value {
      display: flex;
      justify-content: space-between;
    }
    .summary-item .change {
      font-weight: bold;
    }
    .summary-item .change.positive {
      color: var(--green);
    }
    .summary-item .change.negative {
      color: var(--red);
    }

    /* Salary/Pension Styles */
    .salary-group {
        display: flex;
        flex-direction: column;
        gap: 5px;
        margin-bottom: 10px;
    }
    .salary-group label {
        font-size: 13px;
        font-weight: 500;
        color: var(--header-bg);
    }
    .salary-input-group {
        display: flex;
        align-items: center;
        gap: 5px;
    }
    .salary-input-group input {
        flex-grow: 1;
        max-width: 100px;
    }
    .salary-input-group button {
        flex: none;
        width: 40px;
        min-width: 40px;
        padding: 4px;
        font-size: 11px;
    }


    @media (max-width: 768px) {
      body { font-size: 14px; }
      .container { padding: 0 5px; }
      .header { font-size: 18px; padding: 10px; }
      .header .title { font-size: 18px; }
      .header .datetime { font-size: 12px; }
      .stats-grid { grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 8px; }
      .stat { padding: 6px; }
      .stat-label { font-size: 10px; }
      .stat-value { font-size: 16px; }
      .chart-container { min-height: 250px; }
      .controls-container { grid-template-columns: 1fr; }
      .control-group { padding: 10px; }
      h3 { font-size: 12px; }
      button { font-size: 12px; padding: 6px; min-width: 80px; }
      input[type="number"], input[type="range"], textarea { max-width: 120px; padding: 5px; font-size: 12px; }
      #trade-log { height: 120px; font-size: 10px; }
      #tweet-feed { height: 150px; font-size: 12px; }
      .modal-content { padding: 15px; max-width: 95%; }
      .modal-content h1 { font-size: 20px; }
      .modal-content h2 { font-size: 16px; }
      .modal-content p { font-size: 12px; }
      .notification { top: 10px; right: 10px; padding: 8px 15px; font-size: 12px; }
      .log-group-1, .log-group-2, .log-group-3 { flex-basis: 100%; text-align: center; margin-bottom: 2px; }
      .log-group-1 { order: 1; }
      .log-group-2 { order: 3; }
      .log-group-3 { order: 2; }
      .trade-item { flex-direction: column; }
    }
     @media (min-width: 769px) {
      .controls-container {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    @media (max-width: 414px) {
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
      .input-group { flex-direction: column; align-items: stretch; }
      button { width: 100%; }
      input[type="number"], input[type="range"], textarea { width: 100%; max-width: 100%; }
      .crypto-actions { flex-direction: row; flex-basis: auto; justify-content: space-around; margin-top: 5px; width: 100%; }
      .crypto-actions button { flex: 1; }
      .crypto-actions input[type="number"] { flex: none; width: 60px; max-width: 60px; }
    }
  </style>
</head>
<body>
  <div id="auth-modal" class="modal-overlay" role="dialog" aria-labelledby="auth-title">
    <div class="modal-content">
      <h1 id="auth-title">Giri≈ü Yap</h1>
      <div class="auth-form" id="login-form">
        <div class="input-group">
          <label for="login-username">Kullanƒ±cƒ± Adƒ±</label>
          <input type="text" id="login-username" placeholder="Kullanƒ±cƒ± adƒ±nƒ±z" aria-label="Kullanƒ±cƒ± adƒ±">
        </div>
        <div class="input-group">
          <label for="login-password">≈ûifre</label>
          <input type="password" id="login-password" placeholder="≈ûifreniz" aria-label="≈ûifre">
        </div>
        <button onclick="loginUser()" class="btn-primary" aria-label="Giri≈ü yap">Giri≈ü Yap</button>
        <div class="auth-switch">
          Hesabƒ±nƒ±z yok mu?
          <a onclick="showSignupForm()" aria-label="Kayƒ±t ol">Kayƒ±t Ol</a>
        </div>
      </div>
      <div class="auth-form" id="signup-form" style="display: none;">
        <div class="input-group">
          <label for="signup-username">Kullanƒ±cƒ± Adƒ±</label>
          <input type="text" id="signup-username" placeholder="Kullanƒ±cƒ± adƒ± se√ßin" aria-label="Kullanƒ±cƒ± adƒ±">
        </div>
        <div class="input-group">
          <label for="signup-password">≈ûifre</label>
          <input type="password" id="signup-password" placeholder="≈ûifre se√ßin" aria-label="≈ûifre">
        </div>
        <div class="input-group">
          <label for="signup-confirm-password">≈ûifre Tekrar</label>
          <input type="password" id="signup-confirm-password" placeholder="≈ûifreyi tekrar girin" aria-label="≈ûifre tekrar">
        </div>
        <button onclick="registerUser()" class="btn-primary" aria-label="Kayƒ±t ol">Kayƒ±t Ol</button>
        <div class="auth-switch">
          Zaten hesabƒ±nƒ±z var mƒ±?
          <a onclick="showLoginForm()" aria-label="Giri≈ü yap">Giri≈ü Yap</a>
        </div>
      </div>
    </div>
  </div>

  <div id="scenario-modal" class="modal-overlay" role="dialog" aria-labelledby="scenario-title">
    <div class="modal-content">
      <h1 id="scenario-title">Sim√ºlasyona Ho≈ü Geldiniz</h1>
      <p>L√ºtfen bir ba≈ülangƒ±√ß senaryosu ve zorluk seviyesini se√ßin.</p>
      <div class="input-group">
        <label for="difficulty">Zorluk √áarpanƒ±: <span id="difficulty-value">1.0</span>x</label>
        <input type="range" id="difficulty" min="0.5" max="2.0" step="0.1" value="1.0" oninput="document.getElementById('difficulty-value').textContent = this.value">
      </div>
      <div class="modal-buttons">
        <button onclick="selectScenario('dengeli')" class="btn-primary" aria-label="Dengeli ba≈ülangƒ±√ß senaryosunu se√ß">Dengeli Ba≈ülangƒ±√ß (Normal)</button>
        <button onclick="selectScenario('enflasyon')" class="btn-sell" aria-label="Enflasyon canavarƒ± senaryosunu se√ß">Enflasyon Canavarƒ± (Zor)</button>
        <button onclick="selectScenario('rezerv_krizi')" class="btn-secondary" aria-label="Rezerv krizi senaryosunu se√ß">Rezerv Krizi (√áok Zor)</button>
        <button onclick="selectScenario('secim_ekonomisi')" class="btn-purple" aria-label="Se√ßim Ekonomisi (Politik)">Se√ßim Ekonomisi (Politik)</button>
        <button onclick="selectScenario('global_recession')" class="btn-sell" aria-label="K√ºresel resesyon senaryosunu se√ß">K√ºresel Resesyon (Efsanevi)</button>
      </div>
    </div>
  </div>

  <div id="report-card-modal" class="modal-overlay" role="dialog" aria-labelledby="report-title">
    <div class="modal-content">
      <h2 id="report-title">Ba≈ükanlƒ±k Karnesi</h2>
      <div class="report-grid"></div>
      <p>Piyasalar bir sonraki d√∂neme ili≈ükin yol haritanƒ±zƒ± bekliyor.</p>
      <button onclick="closeModal('report-card-modal')" class="btn-primary" aria-label="Devam et">Devam Et</button>
    </div>
  </div>

  <div id="forward-guidance-modal" class="modal-overlay" role="dialog" aria-labelledby="guidance-title">
    <div class="modal-content">
      <h2 id="guidance-title">S√∂zl√º Y√∂nlendirme</h2>
      <p>PPK toplantƒ±sƒ± yakla≈üƒ±yor. Piyasaya nasƒ±l bir mesaj vereceksiniz?</p>
      <div class="modal-buttons">
        <button onclick="setGuidance('sahin')" class="btn-primary" aria-label="≈ûahin y√∂nlendirme se√ß">ü¶Ö ≈ûahin: "Enflasyonla m√ºcadele mutlak √∂nceliƒüimizdir."</button>
        <button onclick="setGuidance('guvercin')" class="btn-sell" aria-label="G√ºvercin y√∂nlendirme se√ß">üïäÔ∏è G√ºvercin: "B√ºy√ºmeyi destekleyici adƒ±mlarƒ± deƒüerlendiriyoruz."</button>
        <button onclick="setGuidance('notr')" class="btn-secondary" aria-label="N√∂tr y√∂nlendirme se√ß">üòê N√∂tr: "Veriye dayalƒ± temkinli duru≈üumuzu koruyoruz."</button>
      </div>
    </div>
  </div>

  <div id="game-over-screen" class="modal-overlay" role="dialog" aria-labelledby="game-over-title">
    <div class="modal-content">
      <h1 id="game-over-title">Sƒ∞M√úLASYON SONLANDI</h1>
      <p id="game-over-text">Sermaye kontrolleri devreye alƒ±ndƒ±. √úlke ekonomisi aƒüƒ±r bir bedel √∂dedi.</p>
      <div class="input-group">
        <input type="text" id="player-name" placeholder="Adƒ±nƒ±zƒ± girin" aria-label="Skor tablosu i√ßin oyuncu adƒ±">
      </div>
      <button onclick="saveScoreAndReset()" class="btn-primary" aria-label="Skoru kaydet ve yeni oyuna ba≈üla">Skoru Kaydet ve Yeni Oyuna Ba≈üla</button>
    </div>
  </div>

  <div id="pause-modal" class="modal-overlay" role="dialog" aria-labelledby="pause-title">
    <div class="modal-content">
      <h2 id="pause-title">Oyun Duraklatƒ±ldƒ±</h2>
      <p>Oyunu devam ettirmek veya sƒ±fƒ±rlamak i√ßin bir se√ßenek se√ßin.</p>
      <div class="modal-buttons">
        <button onclick="resumeGame()" class="btn-primary" aria-label="Oyunu devam ettir">Devam Et</button>
        <button onclick="resetGame(false)" class="btn-sell" aria-label="Oyunu sƒ±fƒ±rla">Oyunu Sƒ±fƒ±rla</button>
      </div>
    </div>
  </div>

  <div id="leaderboard-modal" class="modal-overlay" role="dialog" aria-labelledby="leaderboard-title">
    <div class="modal-content">
      <h2 id="leaderboard-title">Liderlik Tablosu</h2>
      <div id="leaderboard-table"></div>
      <button onclick="closeModal('leaderboard-modal')" class="btn-primary" aria-label="Liderlik tablosunu kapat">Kapat</button>
    </div>
  </div>

  <div id="advisor-modal" class="modal-overlay" role="dialog" aria-labelledby="advisor-title">
    <div class="modal-content">
      <h2 id="advisor-title">Danƒ±≈üman √ñnerisi</h2>
      <p id="advisor-text"></p>
      <div id="advisor-suggestions" class="modal-buttons"></div>
      <button onclick="closeModal('advisor-modal')" class="btn-secondary" style="margin-top: 15px;" aria-label="Kapat">Te≈üekk√ºrler, Deƒüerlendireceƒüim</button>
    </div>
  </div>

  <div id="afk-summary-modal" class="modal-overlay" role="dialog" aria-labelledby="afk-summary-title">
    <div class="modal-content">
      <h2 id="afk-summary-title">AFK S√ºresi √ñzeti</h2>
      <div id="afk-summary-content"></div>
      <button onclick="closeModal('afk-summary-modal')" class="btn-primary" aria-label="Devam et">Devam Et</button>
    </div>
  </div>

  <div id="notification" class="notification" role="alert"></div>

  <audio id="buy-sound" src="https://actions.google.com/sounds/v1/bank/cash_register.ogg" preload="none"></audio>
  <audio id="sell-sound" src="https://actions.google.com/sounds/v1/ui/ui_tap_forward.ogg" preload="none"></audio>
  <audio id="intervention-sound" src="https://actions.google.com/sounds/v1/alarms/digital_watch_alarm_long.ogg" preload="none"></audio>

  <div class="container">
    <div class="header">
      <div class="title">MERKEZ BANKASI</div>
      <div class="datetime" id="current-datetime"></div>
    </div>
    <div class="content-wrapper">
      <div class="stats-grid">
        <div class="stat"><div class="stat-label" title="Piyasadaki Dolar/T√ºrk Lirasƒ± d√∂viz kuru." aria-label="Dolar/TL kuru">DOLAR/TL KURU</div><div class="stat-value" id="kur-value"></div></div>
        <div class="stat"><div class="stat-label" title="Piyasadaki Euro/T√ºrk Lirasƒ± d√∂viz kuru." aria-label="Euro/TL kuru">EURO/TL KURU</div><div class="stat-value" id="euro-value"></div></div>
        <div class="stat"><div class="stat-label" title="TCMB'nin net kullanƒ±labilir d√∂viz varlƒ±klarƒ±." aria-label="Net rezerv">NET REZERV</div><div class="stat-value" id="rezerv-value"></div></div>
        <div class="stat"><div class="stat-label" title="Piyasadaki ons altƒ±n fiyatƒ±." aria-label="Ons Altƒ±n">ONS ALTIN ($)</div><div class="stat-value gold" id="ons-altin-value"></div></div>
        <div class="stat"><div class="stat-label" title="Piyasadaki gram altƒ±n fiyatƒ±." aria-label="Gram Altƒ±n">GRAM ALTIN (‚Ç∫)</div><div class="stat-value gold" id="gram-altin-value"></div></div>
        <div class="stat"><div class="stat-label" title="Piyasadaki √ßeyrek altƒ±n fiyatƒ±." aria-label="√áeyrek Altƒ±n">√áEYREK ALTIN (‚Ç∫)</div><div class="stat-value gold" id="ceyrek-altin-value"></div></div>
        <div class="stat"><div class="stat-label" title="TCMB'nin bankalara uyguladƒ±ƒüƒ± haftalƒ±k repo faizi oranƒ±." aria-label="Politika faizi">POLƒ∞Tƒ∞KA FAƒ∞Zƒ∞</div><div class="stat-value" id="faiz-value"></div></div>
        <div class="stat"><div class="stat-label" title="T√ºketici fiyatlarƒ±ndaki yƒ±llƒ±k deƒüi≈üim." aria-label="Man≈üet enflasyon">MAN≈ûET ENFLASYON</div><div class="stat-value" id="enflasyon-value"></div></div>
        <div class="stat"><div class="stat-label" title="Hanehalkƒ± ve firmalarƒ±n gelecekteki enflasyona dair beklentileri." aria-label="Enflasyon beklentisi">ENFLASYON BEKLENTƒ∞Sƒ∞</div><div class="stat-value" id="beklenti-value"></div></div>
        <div class="stat"><div class="stat-label" title="T√ºrkiye'nin 5 yƒ±llƒ±k kredi temerr√ºt risk primi." aria-label="T√ºrkiye CDS">T√úRKƒ∞YE CDS</div><div class="stat-value" id="cds-value"></div></div>
        <div class="stat"><div class="stat-label" title="√úlke ekonomisinin √ßeyreklik b√ºy√ºme hƒ±zƒ±." aria-label="B√ºy√ºme">B√úY√úME (GSYƒ∞H)</div><div class="stat-value" id="buyume-value"></div></div>
        <div class="stat"><div class="stat-label" title="√úlkenin dƒ±≈ü ticaret ve hizmetler dengesinin GSYƒ∞H'e oranƒ±." aria-label="Cari a√ßƒ±k">CARƒ∞ A√áIK / GSYƒ∞H</div><div class="stat-value" id="cari-acik-value"></div></div>
        <div class="stat"><div class="stat-label" title="Bankalarƒ±n TCMB'de tutmak zorunda olduƒüu mevduat oranƒ±." aria-label="Zorunlu kar≈üƒ±lƒ±k">ZORUNLU KAR≈ûILIK</div><div class="stat-value" id="zk-value"></div></div>
        <div class="stat"><div class="stat-label" title="Politikalarƒ±nƒ±zƒ±n piyasalar nezdindeki inandƒ±rƒ±cƒ±lƒ±ƒüƒ±." aria-label="Ba≈ükan kredibilitesi">BA≈ûKAN KREDƒ∞Bƒ∞Lƒ∞TESƒ∞</div><div class="stat-value" id="kredi-value"></div></div>
        <div class="stat"><div class="stat-label" title="Aldƒ±ƒüƒ±nƒ±z kararlarƒ±n h√ºk√ºmet tarafƒ±ndan ne kadar desteklendiƒüi." aria-label="H√ºk√ºmet g√ºveni">H√úK√úMET G√úVENƒ∞</div><div class="stat-value" id="guven-value"></div><div id="hukumet-guveni-bar"><div id="hukumet-guveni-bar-inner"></div></div></div>
        <div class="stat"><div class="stat-label" title="Para Politikasƒ± Kurulu'nun faiz kararƒ± i√ßin toplanmasƒ±na kalan s√ºre." aria-label="PPK toplantƒ±sƒ±na kalan s√ºre">PPK TOPLANTISINA</div><div class="stat-value" id="ppk-countdown"></div></div>
        <div class="stat"><div class="stat-label" title="√úlkenin toplam n√ºfusu." aria-label="Toplam N√ºfus">TOPLAM N√úFUS</div><div class="stat-value" id="nufus-value"></div></div>
        <div class="stat"><div class="stat-label" title="Kayƒ±t dƒ±≈üƒ± ekonomik faaliyetlerin GSYƒ∞H'ye oranƒ±." aria-label="Gri Ekonomi">GRƒ∞ EKONOMƒ∞</div><div class="stat-value" id="gri-ekonomi-value"></div></div>
        <div class="stat"><div class="stat-label" title="Vatanda≈ülarƒ±n toplam tasarruflarƒ±nƒ±n d√∂viz cinsinden tutulan oranƒ±." aria-label="D√∂viz Tasarruf Seviyesi">D√ñVƒ∞Z TASARRUF SEVƒ∞YESƒ∞</div><div class="stat-value" id="doviz-tasarruf-value"></div></div>
        <div class="stat"><div class="stat-label" title="√úlkedeki aktif i≈ü g√ºc√º b√ºy√ºkl√ºƒü√º." aria-label="ƒ∞≈ü G√ºc√º">ƒ∞≈û G√úC√ú</div><div class="stat-value" id="is-gucu-value"></div></div>
        <div class="stat"><div class="stat-label" title="Son √ßeyrekteki net g√∂√ßmen sayƒ±sƒ±." aria-label="Net G√∂√ß">NET G√ñ√á</div><div class="stat-value" id="net-goc-value"></div></div>
        <div class="stat"><div class="stat-label" title="H√ºk√ºmetin b√ºt√ße fazlasƒ± veya a√ßƒ±ƒüƒ± (GSYƒ∞H'ye oranla)." aria-label="B√ºt√ße Dengesi">B√úT√áE DENGESƒ∞</div><div class="stat-value" id="butce-dengesi-value"></div></div>
        <div class="stat"><div class="stat-label" title="Ekonomideki toplam mal ve hizmet talebi." aria-label="Talep">TALEP ENDEKSƒ∞</div><div class="stat-value" id="talep-endeksi-value"></div></div>
        <div class="stat"><div class="stat-label" title="Cumhuriyet altƒ±n fiyatƒ± (TL)." aria-label="Cumhuriyet Altƒ±n">CUMHURƒ∞YET ALTIN (‚Ç∫)</div><div class="stat-value gold" id="cumhuriyet-altin-value"></div></div>
        <div class="stat"><div class="stat-label" title="22 Ayar altƒ±n fiyatƒ± (TL)." aria-label="22 Ayar Altƒ±n">22 AYAR ALTIN (‚Ç∫)</div><div class="stat-value gold" id="yirmi-iki-ayar-altin-value"></div></div>
        <div class="stat" style="padding: 8px;">
          <div class="stat-label" aria-label="Brent petrol fiyatƒ±">BRENT PETROL</div>
          <div class="stat-value" id="brent-value"></div>
        </div>
        <div class="stat" style="padding: 8px;">
          <div class="stat-label" aria-label="K√ºresel risk i≈ütahƒ±">K√úRESEL Rƒ∞SK ƒ∞≈ûTAHI (VIX)</div>
          <div class="stat-value" id="vix-value"></div>
        </div>
        <div class="stat"><div class="stat-label" title="G√ºncel benzin litre fiyatƒ±." aria-label="Benzin fiyatƒ±">BENZƒ∞N</div><div class="stat-value" id="benzin-value"></div></div>
        <div class="stat"><div class="stat-label" title="G√ºncel dizel litre fiyatƒ±." aria-label="Dizel fiyatƒ±">Dƒ∞ZEL</div><div class="stat-value" id="dizel-value"></div></div>
        <div class="stat"><div class="stat-label" title="G√ºncel LPG litre fiyatƒ±." aria-label="LPG fiyatƒ±">LPG</div><div class="stat-value" id="lpg-value"></div></div>
      </div>

      <main class="main-content">
        <div class="chart-container"><canvas id="dolarGrafik" aria-label="Dolar/TL kuru grafiƒüi"></canvas></div>
        <div class="controls-container">
          <div class="control-group">
            <h3>Piyasaya M√ºdahale</h3>
            <div class="input-group">
              <input type="number" id="doviz-miktar" placeholder="Milyar $" value="1" min="0.1" step="0.1" aria-label="D√∂viz satƒ±≈ü miktarƒ±">
              <button id="btn-manuel-sat" onclick="dovizSat()" class="btn-sell" aria-label="D√∂viz satƒ±≈üƒ± yap">Manuel Satƒ±≈ü</button>
            </div>
            <div class="input-group">
              <input type="number" id="rezerv-ekle-miktar" placeholder="Milyar $" value="10" min="1" step="1" aria-label="Finansman miktarƒ±">
              <button id="btn-rezerv-ekle" onclick="rezervEkle()" class="btn-buy" aria-label="Dƒ±≈ü finansman bul">Dƒ±≈ü Finansman Bul</button>
            </div>
            <div class="input-group">
                <input type="number" id="euro-miktar" placeholder="Milyon ‚Ç¨" value="100" min="1" step="10" aria-label="Euro satƒ±≈ü miktarƒ±">
                <button onclick="euroSat()" class="btn-sell" aria-label="Euro satƒ±≈üƒ± yap">Euro Sat</button>
            </div>
            <div class="input-group">
                <input type="number" id="altin-miktar" placeholder="Gram" value="1000" min="1" step="100" aria-label="Altƒ±n satƒ±≈ü miktarƒ±">
                <button onclick="altinSat()" class="btn-sell" aria-label="Altƒ±n satƒ±≈üƒ± yap">Altƒ±n Sat</button>
            </div>
          </div>
          <div class="control-group">
            <h3>Otomatik M√ºdahale</h3>
            <div class="input-group">
              <input type="number" id="oto-doviz-miktar" placeholder="Milyar $" value="0.5" min="0.1" step="0.1" aria-label="Otomatik satƒ±≈ü miktarƒ±">
              <button id="oto-sat-baslat" onclick="startAutoSell()" class="btn-primary" aria-label="Otomatik satƒ±≈üƒ± ba≈ülat">5sn'de Bir Sat</button>
            </div>
            <button id="oto-sat-durdur" onclick="stopAutoSell()" class="btn-sell" disabled aria-label="Otomatik satƒ±≈üƒ± durdur">Otomatik Satƒ±≈üƒ± Durdur</button>
          </div>
          <div class="control-group">
            <h3>Finansal ƒ∞stikrar</h3>
            <button id="kkm-btn" onclick="toggleKKM()" class="btn-purple" aria-label="KKM sistemini aktif et">KKM Sistemini Aktif Et</button>
            <div class="input-group" style="margin-top: 8px;">
              <button onclick="changeZK(-0.5)" class="btn-secondary" aria-label="Zorunlu kar≈üƒ±lƒ±ƒüƒ± azalt">-</button>
              <span>Zorunlu Kar≈üƒ±lƒ±k</span>
              <button onclick="changeZK(0.5)" class="btn-secondary" aria-label="Zorunlu kar≈üƒ±lƒ±ƒüƒ± artƒ±r">+</button>
            </div>
            <button onclick="applyMacroPru('limit_consumer_credit')" class="btn-secondary" style="margin-top: 5px;" aria-label="T√ºketici kredilerini sƒ±kƒ±la≈ütƒ±r">T√ºketici Kredilerini Sƒ±kƒ±la≈ütƒ±r</button>
            <h3 style="margin-top: 15px;">Kayƒ±t Dƒ±≈üƒ± Ekonomiyle M√ºcadele</h3>
            <button onclick="changeGreyEconomyPolicy('sikilastir')" class="btn-primary" aria-label="Kayƒ±t dƒ±≈üƒ± ekonomi denetimlerini sƒ±kƒ±la≈ütƒ±r">Denetimleri Sƒ±kƒ±la≈ütƒ±r</button>
            <button onclick="changeGreyEconomyPolicy('gevset')" class="btn-secondary" style="margin-top: 5px;" aria-label="Kayƒ±t dƒ±≈üƒ± ekonomi denetimlerini gev≈üet">Denetimleri Gev≈üet</button>
          </div>
          <div class="control-group">
            <h3>Para & Sistem Politikasƒ±</h3>
            <div class="input-group">
              <input type="number" id="faiz-oran" placeholder="Yeni Faiz Oranƒ± %" step="0.25" min="0" aria-label="Yeni faiz oranƒ±">
              <button id="faiz-btn" onclick="faizDegistir()" class="btn-primary" disabled aria-label="Faizi deƒüi≈ütir">Faizi Deƒüi≈ütir</button>
            </div>
            <button onclick="applyCapitalControls()" class="btn-sell" style="margin-top: 8px;" aria-label="Sermaye Kontrolleri uygula">Sermaye Kontrolleri</button>
            <button onclick="showPauseModal()" class="btn-secondary" style="margin-top: 5px;" aria-label="Oyunu duraklat">Oyunu Duraklat</button>
            <button onclick="showLeaderboard()" class="btn-purple" style="margin-top: 5px;" aria-label="Liderlik Tablosu">Liderlik Tablosu</button>
            <button onclick="resetGame(false)" class="btn-secondary" style="margin-top: 5px;" aria-label="Oyunu sƒ±fƒ±rla">Oyunu Sƒ±fƒ±rla</button>
            <button onclick="showAdvisorSuggestion()" class="btn-purple" style="margin-top: 5px;" aria-label="Danƒ±≈ümanlardan √∂neri al">Danƒ±≈ümanlardan Fikir Al</button>
            <button onclick="toggleDarkMode()" class="btn-secondary" style="margin-top: 5px;" aria-label="Gece modunu a√ß/kapat">Gece Modu</button>
          </div>
          <div class="control-group">
            <h3>N√ºfus & ƒ∞≈ü G√ºc√º Politikalarƒ±</h3>
            <div class="input-group">
              <input type="number" id="goc-politikasi-miktar" placeholder="Bin ki≈üi" value="10" min="-100" step="10" aria-label="G√∂√ß politikasƒ± miktarƒ±">
              <button onclick="setMigrationPolicy('cekici')" class="btn-buy" aria-label="G√∂√ß√º te≈üvik et">G√∂√ß√º Te≈üvik Et</button>
              <button onclick="setMigrationPolicy('caydirici')" class="btn-sell" aria-label="G√∂√ß√º caydƒ±r">G√∂√ß√º Caydƒ±r</button>
            </div>
            <button onclick="investInEducation()" class="btn-primary" style="margin-top: 5px;" aria-label="Eƒüitime yatƒ±rƒ±m yap">Eƒüitime Yatƒ±rƒ±m Yap</button>
            <button onclick="investInHealthcare()" class="btn-primary" style="margin-top: 5px;" aria-label="Saƒülƒ±ƒüa Yatƒ±rƒ±m Yap">Saƒülƒ±ƒüa Yatƒ±rƒ±m Yap</button>
          </div>
          <div class="control-group">
            <h3>Maliye Politikalarƒ±</h3>
            <div class="input-group">
              <button onclick="adjustFiscalPolicy('harcama', -0.5)" class="btn-sell" aria-label="Kamu harcamalarƒ±nƒ± azalt">- Harcama</button>
              <span>Kamu Harcamalarƒ±</span>
              <button onclick="adjustFiscalPolicy('harcama', 0.5)" class="btn-buy" aria-label="Kamu harcamalarƒ±nƒ± artƒ±r">+ Harcama</button>
            </div>
            <div class="input-group" style="margin-top: 8px;">
              <button onclick="adjustFiscalPolicy('vergi', -0.1)" class="btn-sell" aria-label="Vergileri azalt">- Vergi</button>
              <span>Genel Vergi Oranlarƒ±</span>
              <button onclick="adjustFiscalPolicy('vergi', 0.1)" class="btn-buy" aria-label="Vergileri artƒ±r">+ Vergi</button>
            </div>
            <button onclick="launchInfrastructureProject()" class="btn-purple" style="margin-top: 5px;" aria-label="Altyapƒ± projesi ba≈ülat">Altyapƒ± Projesi Ba≈ülat</button>
          </div>
          <div class="control-group">
            <h3>Vergi Politikalarƒ±</h3>
            <div class="input-group">
              <button onclick="adjustTax('kdv', -1)" class="btn-secondary" aria-label="KDV oranƒ±nƒ± azalt">-</button>
              <span>KDV Oranƒ±: <span id="kdv-oran-value"></span>%</span>
              <button onclick="adjustTax('kdv', 1)" class="btn-secondary" aria-label="KDV oranƒ±nƒ± artƒ±r">+</button>
            </div>
            <div class="input-group" style="margin-top: 8px;">
              <button onclick="adjustTax('gelir', -0.5)" class="btn-secondary" aria-label="Gelir vergisi oranƒ±nƒ± azalt">-</button>
              <span>Gelir Vergisi: <span id="gelir-vergi-oran-value"></span>%</span>
              <button onclick="adjustTax('gelir', 0.5)" class="btn-secondary" aria-label="Gelir vergisi oranƒ±nƒ± artƒ±r">+</button>
            </div>
            <div class="input-group" style="margin-top: 8px;">
              <button onclick="adjustTax('kurumlar', -1)" class="btn-secondary" aria-label="Kurumlar vergisi oranƒ±nƒ± azalt">-</button>
              <span>Kurumlar Vergisi: <span id="kurumlar-vergi-oran-value"></span>%</span>
              <button onclick="adjustTax('kurumlar', 1)" class="btn-secondary" aria-label="Kurumlar vergisi oranƒ±nƒ± artƒ±r">+</button>
            </div>
          </div>
          <div class="control-group">
            <h3>Maa≈ü & Emekli Aylƒ±ƒüƒ± Politikalarƒ±</h3>
            <div class="salary-group">
                <label for="memur-maas-polis">Polis Maa≈üƒ± (‚Ç∫)</label>
                <div class="salary-input-group">
                    <input type="number" id="memur-maas-polis" value="35000" step="1000">
                    <button onclick="adjustSalary('polis')" class="btn-primary">Ayarla</button>
                </div>
            </div>
            <div class="salary-group">
                <label for="memur-maas-asker">Asker Maa≈üƒ± (‚Ç∫)</label>
                <div class="salary-input-group">
                    <input type="number" id="memur-maas-asker" value="38000" step="1000">
                    <button onclick="adjustSalary('asker')" class="btn-primary">Ayarla</button>
                </div>
            </div>
            <div class="salary-group">
                <label for="memur-maas-belediye">Belediye Memuru Maa≈üƒ± (‚Ç∫)</label>
                <div class="salary-input-group">
                    <input type="number" id="memur-maas-belediye" value="32000" step="1000">
                    <button onclick="adjustSalary('belediye')" class="btn-primary">Ayarla</button>
                </div>
            </div>
            <div class="salary-group">
                <label for="emekli-maas-sgk">SGK Emekli Maa≈üƒ± (‚Ç∫)</label>
                <div class="salary-input-group">
                    <input type="number" id="emekli-maas-sgk" value="10000" step="500">
                    <button onclick="adjustPension('sgk')" class="btn-primary">Ayarla</button>
                </div>
            </div>
            <div class="salary-group">
                <label for="emekli-maas-bagkur">Baƒükur Emekli Maa≈üƒ± (‚Ç∫)</label>
                <div class="salary-input-group">
                    <input type="number" id="emekli-maas-bagkur" value="8500" step="500">
                    <button onclick="adjustPension('bagkur')" class="btn-primary">Ayarla</button>
                </div>
            </div>
            <div class="salary-group">
                <label for="emekli-maas-en-dusuk">En D√º≈ü√ºk Emekli Maa≈üƒ± (‚Ç∫)</label>
                <div class="salary-input-group">
                    <input type="number" id="emekli-maas-en-dusuk" value="7500" step="500">
                    <button onclick="adjustPension('enDusuk')" class="btn-primary">Ayarla</button>
                </div>
            </div>
          </div>
          <div class="control-group">
            <h3>Ba≈ükanlƒ±k A√ßƒ±klamasƒ±</h3>
            <textarea id="public-statement-text" placeholder="Halka bir mesaj yazƒ±n... (√ñrn: Enflasyonla m√ºcadele edeceƒüiz!)" aria-label="Ba≈ükanlƒ±k a√ßƒ±klamasƒ±"></textarea>
            <button onclick="makePublicStatement()" class="btn-primary" style="margin-top: 8px;">A√ßƒ±klama Yap</button>
          </div>
          <div class="control-group">
            <h3>Kripto Piyasasƒ±</h3>
            <div id="crypto-market-container"></div>
          </div>
        </div>
      </main>

      <div class="trade-log-container">
        <h3>Piyasa ƒ∞≈ülemleri</h3>
        <ul id="trade-log" aria-label="Piyasa i≈ülemleri g√ºnl√ºƒü√º"></ul>
      </div>

      <div class="social-media-feed-container">
        <h3>Sosyal Medya Akƒ±≈üƒ±</h3>
        <ul id="tweet-feed" aria-label="Sosyal Medya Tweet Akƒ±≈üƒ±"></ul>
      </div>
    </div>
  </div>

  <div class="news-ticker" role="marquee"><div class="news-content" id="news-content"></div></div>

  <script>
    // --- STATE & CONFIG ---
    const SAVE_KEY = 'mbSimulationSaveData_v12_7'; // Updated save key
    const LEADERBOARD_KEY = 'mbSimulationLeaderboard_v12_7'; // Updated leaderboard key
    const USERS_KEY = 'mbSimulationUsers_v12_7'; // Updated users key
    let state = {};
    let autoSellIntervalId = null, gameIntervalId = null, newsIntervalId = null, tweetIntervalId = null, datetimeIntervalId = null;
    let lastKur = 0;
    let lastEuro = 0;
    let lastGramAltin = 0;
    const PPK_CYCLE = 90; // 90 saniye
    let isGameRunning = false;
    let lastRezervEkleTime = 0;
    const REZERV_EKLE_COOLDOWN = 30; // 30 saniye
    const DEBUG_MODE = false;
    let audioInitialized = false;
    let currentUser = null;
    let lastSavedState = null;
    let lastSaveTime = null;

    // Kripto para konfig√ºrasyonu
    const CRYPTO_CONFIG = [
      { id: 'btc', name: 'Bitcoin', initialPrice: 65000, volatility: 0.03, correlation: 1 },
      { id: 'eth', name: 'Ethereum', initialPrice: 3500, volatility: 0.04, correlation: 0.9 },
      { id: 'doge', name: 'Dogecoin', initialPrice: 0.15, volatility: 0.08, correlation: 0.6 },
      { id: 'shib', name: 'Shiba Inu', initialPrice: 0.000025, volatility: 0.1, correlation: 0.5 },
      { id: 'sol', name: 'Solana', initialPrice: 150, volatility: 0.05, correlation: 0.8 },
    ];

    // Banka isimleri
    const BANK_NAMES = ['Garanti BBVA', 'Halkbank', 'Ziraat Bankasƒ±', 'Vakƒ±fBank', 'Akbank', 'ƒ∞≈ü Bankasƒ±', 'Yapƒ± Kredi'];
    // Senaryolar
    const scenarios = {
      dengeli: {
        kur: 42.1000, euro: 46.0000, rezerv: 100.0, faiz: 50.00, enflasyon: 75.0, enflasyonBeklentisi: 60.0,
        cds: 400, buyume: 1.5, kredibilite: 50, ppkDayCountdown: PPK_CYCLE, isPpkDay: false,
        sermayeKontrolu: false, kurGecmisi: [], zamanGecmisi: [], piyasaEtkisi: 0,
        zorunluKarsilik: 8.0, cariAcik: -4.5, hukumetGuveni: 50, piyasaYonlendirmesi: 'notr',
        kkmActive: false, kkmYuku: 0, bankaSaglamligi: 80, brentFiyati: 85.0, vixIndex: 15.0,
        benzinFiyati: 40.0, dizelFiyati: 38.0, lpgFiyati: 20.0,
        nufus: 85.0, dogumOrani: 0.012, olumOrani: 0.006, netGoc: 0.0, isGucuKatilimOrani: 50.0, issizlikOrani: 10.0,
        butceDengesiGSYIHOrani: -3.0, kamuHarcamalari: 15.0, vergiOrani: 14.0, talepEndeksi: 100,
        egitimSeviyesi: 70, saglikSeviyesi: 75, kdvOrani: 18.0, gelirVergiOrani: 20.0, kurumlarVergiOrani: 22.0,
        griEkonomiOrani: 25.0, karaParaRiskSeviyesi: 10, dovizTasarrufSeviyesi: 40.0, lastAdvisorTime: 0,
        onsAltin: 2300, gramAltin: 2400, ceyrekAltin: 3900, cumhuriyetAltin: 16000, yirmiIkiAyarAltin: 2350,
        memurMaaslari: { polis: 35000, asker: 38000, belediye: 32000 },
        emekliMaaslari: { sgk: 10000, bagkur: 8500, enDusuk: 7500 },
        publicStatement: '', lastStatementTime: 0,
        publicStatementImpact: { credibility: 0, trust: 0, dollarization: 0, fxEffect: 0, lastHash: '' },
        bankaDovizPozisyonlari: {}, // { bankName: { usd: 100, eur: 50, gold: 10 } }
        mevduatSahibiDovizPozisyonlari: { usd: 1000, eur: 500, gold: 100 }, // Total for all depositors
        kriptolar: CRYPTO_CONFIG.reduce((acc, crypto) => { acc[crypto.id] = { price: crypto.initialPrice, amount: 0, history: [{ time: new Date(), price: crypto.initialPrice }] }; return acc; }, {}),
        scenarioId: 'dengeli'
      },
      enflasyon: {
        kur: 35.0000, euro: 38.0000, rezerv: 80.0, faiz: 30.00, enflasyon: 120.0, enflasyonBeklentisi: 100.0,
        cds: 550, buyume: 0.5, kredibilite: 25, ppkDayCountdown: PPK_CYCLE, isPpkDay: false,
        sermayeKontrolu: false, kurGecmisi: [], zamanGecmisi: [], piyasaEtkisi: 0,
        zorunluKarsilik: 5.0, cariAcik: -6.0, hukumetGuveni: 30, piyasaYonlendirmesi: 'guvercin',
        kkmActive: true, kkmYuku: 50.0, bankaSaglamligi: 60, brentFiyati: 90.0, vixIndex: 20.0,
        benzinFiyati: 45.0, dizelFiyati: 43.0, lpgFiyati: 23.0,
        nufus: 85.0, dogumOrani: 0.012, olumOrani: 0.006, netGoc: 0.0, isGucuKatilimOrani: 50.0, issizlikOrani: 12.0,
        butceDengesiGSYIHOrani: -4.0, kamuHarcamalari: 18.0, vergiOrani: 12.0, talepEndeksi: 110,
        egitimSeviyesi: 65, saglikSeviyesi: 70, kdvOrani: 15.0, gelirVergiOrani: 18.0, kurumlarVergiOrani: 20.0,
        griEkonomiOrani: 30.0, karaParaRiskSeviyesi: 20, dovizTasarrufSeviyesi: 60.0, lastAdvisorTime: 0,
        onsAltin: 2000, gramAltin: 2100, ceyrekAltin: 3400, cumhuriyetAltin: 14000, yirmiIkiAyarAltin: 2050,
        memurMaaslari: { polis: 30000, asker: 33000, belediye: 28000 },
        emekliMaaslari: { sgk: 8000, bagkur: 7000, enDusuk: 6500 },
        publicStatement: '', lastStatementTime: 0,
        publicStatementImpact: { credibility: 0, trust: 0, dollarization: 0, fxEffect: 0, lastHash: '' },
        bankaDovizPozisyonlari: {},
        mevduatSahibiDovizPozisyonlari: { usd: 1500, eur: 800, gold: 200 },
        kriptolar: CRYPTO_CONFIG.reduce((acc, crypto) => { acc[crypto.id] = { price: crypto.initialPrice, amount: 0, history: [{ time: new Date(), price: crypto.initialPrice }] }; return acc; }, {}),
        scenarioId: 'enflasyon'
      },
      rezerv_krizi: {
        kur: 55.0000, euro: 60.0000, rezerv: 20.0, faiz: 60.00, enflasyon: 90.0, enflasyonBeklentisi: 80.0,
        cds: 700, buyume: -1.0, kredibilite: 15, ppkDayCountdown: PPK_CYCLE, isPpkDay: false,
        sermayeKontrolu: false, kurGecmisi: [], zamanGecmisi: [], piyasaEtkisi: 0,
        zorunluKarsilik: 10.0, cariAcik: -8.0, hukumetGuveni: 20, piyasaYonlendirmesi: 'sahin',
        kkmActive: true, kkmYuku: 100.0, bankaSaglamligi: 40, brentFiyati: 95.0, vixIndex: 25.0,
        benzinFiyati: 50.0, dizelFiyati: 48.0, lpgFiyati: 25.0,
        nufus: 85.0, dogumOrani: 0.012, olumOrani: 0.006, netGoc: 0.0, isGucuKatilimOrani: 48.0, issizlikOrani: 14.0,
        butceDengesiGSYIHOrani: -5.0, kamuHarcamalari: 20.0, vergiOrani: 10.0, talepEndeksi: 80,
        egitimSeviyesi: 60, saglikSeviyesi: 65, kdvOrani: 12.0, gelirVergiOrani: 15.0, kurumlarVergiOrani: 18.0,
        griEkonomiOrani: 35.0, karaParaRiskSeviyesi: 40, dovizTasarrufSeviyesi: 75.0, lastAdvisorTime: 0,
        onsAltin: 2500, gramAltin: 2700, ceyrekAltin: 4400, cumhuriyetAltin: 18000, yirmiIkiAyarAltin: 2600,
        memurMaaslari: { polis: 28000, asker: 30000, belediye: 25000 },
        emekliMaaslari: { sgk: 7000, bagkur: 6000, enDusuk: 5500 },
        publicStatement: '', lastStatementTime: 0,
        publicStatementImpact: { credibility: 0, trust: 0, dollarization: 0, fxEffect: 0, lastHash: '' },
        bankaDovizPozisyonlari: {},
        mevduatSahibiDovizPozisyonlari: { usd: 2000, eur: 1000, gold: 300 },
        kriptolar: CRYPTO_CONFIG.reduce((acc, crypto) => { acc[crypto.id] = { price: crypto.initialPrice, amount: 0, history: [{ time: new Date(), price: crypto.initialPrice }] }; return acc; }, {}),
        scenarioId: 'rezerv_krizi'
      },
       secim_ekonomisi: {
        kur: 40.0000, euro: 43.0000, rezerv: 90.0, faiz: 20.00, enflasyon: 100.0, enflasyonBeklentisi: 90.0,
        cds: 450, buyume: 3.0, kredibilite: 40, ppkDayCountdown: PPK_CYCLE, isPpkDay: false,
        sermayeKontrolu: false, kurGecmisi: [], zamanGecmisi: [], piyasaEtkisi: 0,
        zorunluKarsilik: 6.0, cariAcik: -7.0, hukumetGuveni: 70, piyasaYonlendirmesi: 'guvercin',
        kkmActive: true, kkmYuku: 70.0, bankaSaglamligi: 70, brentFiyati: 80.0, vixIndex: 12.0,
        benzinFiyati: 38.0, dizelFiyati: 36.0, lpgFiyati: 18.0,
        nufus: 85.0, dogumOrani: 0.012, olumOrani: 0.006, netGoc: 0.5, isGucuKatilimOrani: 55.0, issizlikOrani: 8.0,
        butceDengesiGSYIHOrani: -6.0, kamuHarcamalari: 25.0, vergiOrani: 10.0, talepEndeksi: 120,
        egitimSeviyesi: 70, saglikSeviyesi: 75, kdvOrani: 15.0, gelirVergiOrani: 16.0, kurumlarVergiOrani: 19.0,
        griEkonomiOrani: 28.0, karaParaRiskSeviyesi: 15, dovizTasarrufSeviyesi: 50.0, lastAdvisorTime: 0,
        onsAltin: 2200, gramAltin: 2300, ceyrekAltin: 3700, cumhuriyetAltin: 15500, yirmiIkiAyarAltin: 2250,
        memurMaaslari: { polis: 37000, asker: 40000, belediye: 35000 },
        emekliMaaslari: { sgk: 11000, bagkur: 9500, enDusuk: 8000 },
        publicStatement: '', lastStatementTime: 0,
        publicStatementImpact: { credibility: 0, trust: 0, dollarization: 0, fxEffect: 0, lastHash: '' },
        bankaDovizPozisyonlari: {},
        mevduatSahibiDovizPozisyonlari: { usd: 800, eur: 400, gold: 80 },
        kriptolar: CRYPTO_CONFIG.reduce((acc, crypto) => { acc[crypto.id] = { price: crypto.initialPrice, amount: 0, history: [{ time: new Date(), price: crypto.initialPrice }] }; return acc; }, {}),
        scenarioId: 'secim_ekonomisi'
      },
      global_recession: {
        kur: 42.1000, euro: 46.0000, rezerv: 100.0, faiz: 50.00, enflasyon: 75.0, enflasyonBeklentisi: 60.0,
        cds: 400, buyume: -2.0, kredibilite: 50, ppkDayCountdown: PPK_CYCLE, isPpkDay: false,
        sermayeKontrolu: false, kurGecmisi: [], zamanGecmisi: [], piyasaEtkisi: 0,
        zorunluKarsilik: 8.0, cariAcik: -2.0, hukumetGuveni: 50, piyasaYonlendirmesi: 'notr',
        kkmActive: false, kkmYuku: 0, bankaSaglamligi: 80, brentFiyati: 70.0, vixIndex: 35.0,
        benzinFiyati: 35.0, dizelFiyati: 33.0, lpgFiyati: 17.0,
        nufus: 85.0, dogumOrani: 0.012, olumOrani: 0.006, netGoc: -0.2, isGucuKatilimOrani: 48.0, issizlikOrani: 15.0,
        butceDengesiGSYIHOrani: -4.0, kamuHarcamalari: 12.0, vergiOrani: 15.0, talepEndeksi: 80,
        egitimSeviyesi: 70, saglikSeviyesi: 75, kdvOrani: 18.0, gelirVergiOrani: 20.0, kurumlarVergiOrani: 22.0,
        griEkonomiOrani: 25.0, karaParaRiskSeviyesi: 10, dovizTasarrufSeviyesi: 45.0, lastAdvisorTime: 0,
        onsAltin: 2100, gramAltin: 2200, ceyrekAltin: 3600, cumhuriyetAltin: 15000, yirmiIkiAyarAltin: 2150,
        memurMaaslari: { polis: 33000, asker: 36000, belediye: 30000 },
        emekliMaaslari: { sgk: 9000, bagkur: 7800, enDusuk: 7000 },
        publicStatement: '', lastStatementTime: 0,
        publicStatementImpact: { credibility: 0, trust: 0, dollarization: 0, fxEffect: 0, lastHash: '' },
        bankaDovizPozisyonlari: {},
        mevduatSahibiDovizPozisyonlari: { usd: 1200, eur: 600, gold: 120 },
        kriptolar: CRYPTO_CONFIG.reduce((acc, crypto) => { acc[crypto.id] = { price: crypto.initialPrice, amount: 0, history: [{ time: new Date(), price: crypto.initialPrice }] }; return acc; }, {}),
        scenarioId: 'global_recession'
      }
    };
    const el = {};
    document.querySelectorAll('[id]').forEach(element => {
      const camelCaseId = element.id.replace(/-([a-z])/g, g => g[1].toUpperCase());
      el[camelCaseId] = element;
    });
    let dolarGrafik;
    let cryptoCharts = {};

    // --- UTILITY FUNCTIONS ---
    function showModal(modalId) {
        if (el[modalId]) el[modalId].style.display = 'flex';
    }

    function closeModal(modalId) {
        if (el[modalId]) el[modalId].style.display = 'none';
    }

    function playSound(soundElement) {
        if (audioInitialized && soundElement) {
            soundElement.currentTime = 0;
            soundElement.play().catch(e => console.log("Audio play failed:", e));
        }
    }

    function initAudio() {
      if (audioInitialized) return;
      document.body.addEventListener('click', () => {
        if (!audioInitialized) {
          el.buySound.play().catch(e => {}); el.buySound.pause();
          el.sellSound.play().catch(e => {}); el.sellSound.pause();
          el.interventionSound.play().catch(e => {}); el.interventionSound.pause();
          audioInitialized = true;
          console.log("Audio context initialized.");
        }
      }, { once: true });
    }

    function showNotification(message, isError = false) {
        el.notification.textContent = message;
        el.notification.className = 'notification'; // Reset classes
        el.notification.classList.add(isError ? 'error' : 'success');
        el.notification.classList.add('show');
        setTimeout(() => {
            el.notification.classList.remove('show');
        }, 3000);
    }

    function addTradeToLog({ time, type, amount, actor, isIntervention = false, rate, currency = 'USD' }) {
        const item = document.createElement('li');
        item.className = 'trade-item';
        if (isIntervention) item.classList.add('trade-intervention');

        let typeClass = '';
        if (type.toLowerCase().includes('al')) typeClass = 'trade-buy';
        if (type.toLowerCase().includes('sat')) typeClass = 'trade-sell';
        item.classList.add(typeClass);

        let amountDisplay = '';
        if (currency === 'USD' || currency === 'EUR') {
            amountDisplay = `${(amount / 1e9).toFixed(2)} M${currency}`;
        } else if (currency === 'GRAM' || currency === '√áEYREK' || currency === 'CUMHURƒ∞YET' || currency === '22AYAR') {
            amountDisplay = `${amount.toFixed(2)} ${currency}`;
        } else {
            amountDisplay = `${amount.toFixed(2)}`; // Default for other types
        }


        item.innerHTML = `
            <span class="log-group-1"><span class="log-time">${time.toLocaleTimeString()}</span> <span class="log-actor">${actor}</span></span>
            <span class="log-group-2"><span class="log-type">${type}</span></span>
            <span class="log-group-3"><span class="log-amount">${amountDisplay}</span> <span class="log-rate-label">@</span> <span class="log-rate">${rate.toFixed(4)}‚Ç∫</span></span>
        `;
        el.tradeLog.prepend(item);
        if (el.tradeLog.children.length > 100) {
            el.tradeLog.removeChild(el.tradeLog.lastChild);
        }
    }

    function addTweetToFeed(tweet) {
      const item = document.createElement('li');
      item.className = `tweet-item tweet-${tweet.sentiment}`;
      item.innerHTML = `
        <div class="tweet-meta">
          <span class="tweet-user">@${tweet.user}</span>
          <span class="tweet-time">${new Date().toLocaleTimeString()}</span>
        </div>
        <p class="tweet-text">${tweet.text}</p>
      `;
      el.tweetFeed.prepend(item);
      if (el.tweetFeed.children.length > 50) {
        el.tweetFeed.removeChild(el.tweetFeed.lastChild);
      }
    }

    function updateDateTime() {
      const now = new Date();
      const options = { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
      };
      el.currentDatetime.textContent = now.toLocaleDateString('tr-TR', options);
    }

    // --- USER AUTHENTICATION ---
    function loadUsers() {
      const users = localStorage.getItem(USERS_KEY);
      return users ? JSON.parse(users) : {};
    }

    function saveUsers(users) {
      localStorage.setItem(USERS_KEY, JSON.stringify(users));
    }

    function showLoginForm() {
      el.loginForm.style.display = 'flex';
      el.signupForm.style.display = 'none';
      el.authTitle.textContent = 'Giri≈ü Yap';
    }

    function showSignupForm() {
      el.loginForm.style.display = 'none';
      el.signupForm.style.display = 'flex';
      el.authTitle.textContent = 'Kayƒ±t Ol';
    }

    function registerUser() {
      const username = el.signupUsername.value.trim();
      const password = el.signupPassword.value;
      const confirmPassword = el.signupConfirmPassword.value;

      if (!username || !password) {
        showNotification('Kullanƒ±cƒ± adƒ± ve ≈üifre gerekli!', true);
        return;
      }

      if (password !== confirmPassword) {
        showNotification('≈ûifreler uyu≈ümuyor!', true);
        return;
      }

      const users = loadUsers();
      if (users[username]) {
        showNotification('Bu kullanƒ±cƒ± adƒ± zaten alƒ±nmƒ±≈ü!', true);
        return;
      }

      users[username] = { password };
      saveUsers(users);
      showNotification('Kayƒ±t ba≈üarƒ±lƒ±! Giri≈ü yapabilirsiniz.', false);
      showLoginForm();
    }

    function loginUser() {
      const username = el.loginUsername.value.trim();
      const password = el.loginPassword.value;
      if (!username || !password) {
        showNotification('Kullanƒ±cƒ± adƒ± ve ≈üifre gerekli!', true);
        return;
      }

      const users = loadUsers();
      if (!users[username] || users[username].password !== password) {
        showNotification('Ge√ßersiz kullanƒ±cƒ± adƒ± veya ≈üifre!', true);
        return;
      }

      currentUser = username;
      closeModal('authModal');
      showModal('scenarioModal');
      showNotification(`Ho≈ü geldiniz, ${username}!`, false);
    }

    function logoutUser() {
      currentUser = null;
      resetGame(false);
      showModal('authModal');
      showLoginForm();
    }

    // --- SAVE/LOAD GAME STATE ---
    function saveUserGameState() {
      if (!currentUser || !isGameRunning) return;
      try {
        const users = loadUsers();
        if (!users[currentUser]) {
          users[currentUser] = {};
        }

        const stateToSave = { 
          ...state,
          lastSaveTime: new Date().getTime()
        };
        // Convert dates to timestamps for JSON serialization
        stateToSave.zamanGecmisi = state.zamanGecmisi.map(d => d.getTime());
        Object.keys(stateToSave.kriptolar).forEach(key => {
            stateToSave.kriptolar[key].history = stateToSave.kriptolar[key].history.map(h => ({ time: h.time.getTime(), price: h.price }));
        });
        users[currentUser].gameState = stateToSave;
        saveUsers(users);
        lastSaveTime = stateToSave.lastSaveTime;
      } catch (e) {
        console.error('Failed to save state:', e);
      }
    }

    function loadUserGameState() {
      if (!currentUser) return false;
      const users = loadUsers();
      if (!users[currentUser] || !users[currentUser].gameState) {
        return false;
      }

      try {
        const savedState = users[currentUser].gameState;
        // Convert timestamps back to dates
        savedState.zamanGecmisi = savedState.zamanGecmisi.map(t => new Date(t));
        Object.keys(savedState.kriptolar).forEach(key => {
          savedState.kriptolar[key].history = savedState.kriptolar[key].history.map(h => ({ time: new Date(h.time), price: h.price }));
        });
        state = savedState;
        lastSaveTime = savedState.lastSaveTime;
        isGameRunning = true;
        initAudio();
        startGame();
        // Show AFK summary if applicable
        if (lastSaveTime) {
          const afkSeconds = Math.floor((new Date().getTime() - lastSaveTime) / 1000);
          if (afkSeconds > 60) { // Only show if AFK for more than 1 minute
            showAfkSummary(afkSeconds);
          }
        }

        return true;
      } catch (e) {
        console.error('Failed to parse saved state:', e);
        return false;
      }
    }

    function showAfkSummary(afkSeconds) {
      const afkMinutes = Math.floor(afkSeconds / 60);
      const afkHours = Math.floor(afkMinutes / 60);
      const afkDays = Math.floor(afkHours / 24);

      let afkTimeStr = '';
      if (afkDays > 0) {
        afkTimeStr = `${afkDays} g√ºn ${afkHours % 24} saat`;
      } else if (afkHours > 0) {
        afkTimeStr = `${afkHours} saat ${afkMinutes % 60} dakika`;
      } else {
        afkTimeStr = `${afkMinutes} dakika ${afkSeconds % 60} saniye`;
      }

      const oldState = JSON.parse(JSON.stringify(state)); // Deep copy for comparison

      // Simulate AFK time (1 game loop per 2 seconds)
      const loopsToSimulate = Math.floor(afkSeconds / 2);
      for (let i = 0; i < loopsToSimulate; i++) {
        oyunDongusu(true); // Pass true to indicate AFK simulation
      }

      // Prepare summary content
      let summaryHtml = `
        <div class="summary-item">
          <div class="label">AFK Kalma S√ºresi:</div>
          <div class="value">${afkTimeStr}</div>
        </div>
      `;
      // Add key metrics changes
      const metrics = [
        { label: 'Dolar/TL Kuru', key: 'kur', format: v => v.toFixed(4), isPositiveGood: false },
        { label: 'Euro/TL Kuru', key: 'euro', format: v => v.toFixed(4), isPositiveGood: false },
        { label: 'Net Rezerv', key: 'rezerv', format: v => v.toFixed(1) + ' Milyar $', isPositiveGood: true },
        { label: 'Enflasyon', key: 'enflasyon', format: v => v.toFixed(1) + '%', isPositiveGood: false },
        { label: 'B√ºy√ºme', key: 'buyume', format: v => v.toFixed(1) + '%', isPositiveGood: true },
        { label: 'CDS', key: 'cds', format: v => v.toFixed(0), isPositiveGood: false },
        { label: 'Gram Altƒ±n', key: 'gramAltin', format: v => v.toFixed(2) + ' ‚Ç∫', isPositiveGood: false },
        { label: 'Benzin Fiyatƒ±', key: 'benzinFiyati', format: v => v.toFixed(2) + ' ‚Ç∫', isPositiveGood: false }
      ];
      metrics.forEach(metric => {
        const oldValue = oldState[metric.key];
        const newValue = state[metric.key];
        const change = newValue - oldValue;

        let changeClass = '';
        let changeSymbol = '';

        if (change > 0) {
          changeClass = metric.isPositiveGood ? 'positive' : 'negative';
          changeSymbol = '+';
        } else if (change < 0) {
          changeClass = metric.isPositiveGood ? 'negative' : 'positive';
        }

        summaryHtml += `
          <div class="summary-item">
            <div class="label">${metric.label}:</div>
            <div class="value">
              <span>${metric.format(newValue)}</span>
              <span class="change ${changeClass}">
                (${changeSymbol}${metric.format(change)})
              </span>
            </div>
          </div>
        `;
      });
      el.afkSummaryContent.innerHTML = summaryHtml;
      showModal('afkSummaryModal');
    }

    // --- INITIALIZATION ---
    window.onload = function() {
      createMainChart();
      updateDateTime();
      datetimeIntervalId = setInterval(updateDateTime, 1000);

      // Initialize all elements
      document.querySelectorAll('[id]').forEach(element => {
        const camelCaseId = element.id.replace(/-([a-z])/g, g => g[1].toUpperCase());
        el[camelCaseId] = element;
      });
      // Show auth modal first
      showModal('authModal');
      // Try to load game state if returning user
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.has('user')) {
        const username = urlParams.get('user');
        const users = loadUsers();
        if (users[username]) {
          el.loginUsername.value = username;
          showNotification(`Ho≈ü geldiniz ${username}, l√ºtfen giri≈ü yapƒ±n.`, false);
        }
      }

      el.faizOran.addEventListener('input', () => {
        el.faizBtn.disabled = !state.isPpkDay || isNaN(parseFloat(el.faizOran.value)) || parseFloat(el.faizOran.value) < 0;
      });
      el.difficulty.addEventListener('input', () => {
          el.difficultyValue.textContent = parseFloat(el.difficulty.value).toFixed(1);
      });
      // Check for dark mode preference
      if (localStorage.getItem('darkMode') === 'enabled') {
          document.body.classList.add('dark-mode');
      }
    };

    function createMainChart() {
      if (!dolarGrafik && el.dolarGrafik) {
        dolarGrafik = new Chart(el.dolarGrafik.getContext('2d'), {
          type: 'line',
          data: { labels: [], datasets: [{ label: 'Dolar/TL', data: [], borderColor: '#0d1b2a', borderWidth: 2, pointRadius: 0, tension: 0.3, fill: true, backgroundColor: 'rgba(13, 27, 42, 0.1)' }] },
          options: {
            responsive: true, maintainAspectRatio: false,
            scales: { x: { type: 'time', time: { unit: 'second', displayFormats: { second: 'HH:mm:ss' } } }, y: { beginAtZero: false } },
            plugins: { legend: { display: false } },
            animation: { duration: 500 }
          }
        });
      }
    }

    function initCryptoMarketUI() {
        const container = el.cryptoMarketContainer;
        if (!container) return;
        container.innerHTML = '';
        CRYPTO_CONFIG.forEach(crypto => {
            const cryptoDiv = document.createElement('div');
            cryptoDiv.className = 'crypto-item';
            cryptoDiv.innerHTML = `
                <div class="crypto-info">
                    <span class="crypto-name">${crypto.name} (Sahip olunan: <span id="${crypto.id}-owned">0.00</span>)</span>
                    <span class="crypto-price" id="${crypto.id}-price">$${state.kriptolar[crypto.id].price.toFixed(4)}</span>
                </div>
                <div class="crypto-actions">
                    <input type="number" id="${crypto.id}-amount" placeholder="Dolar" value="1000" min="1">
                    <button onclick="buyCrypto('${crypto.id}')" class="btn-buy">Al</button>
                    <button onclick="sellCrypto('${crypto.id}')" class="btn-sell">Sat</button>
                </div>
                <div class="crypto-chart-container"><canvas id="${crypto.id}-chart"></canvas></div>
            `;
            container.appendChild(cryptoDiv);
        });
        initCryptoCharts();
    }

    function initCryptoCharts() {
        CRYPTO_CONFIG.forEach(config => {
            const ctx = document.getElementById(`${config.id}-chart`);
            if (ctx) {
                if (cryptoCharts[config.id]) cryptoCharts[config.id].destroy();
                const cryptoState = state.kriptolar[config.id];
                cryptoCharts[config.id] = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: cryptoState.history.map(item => item.time),
                        datasets: [{ data: cryptoState.history.map(item => item.price), borderColor: '#6f42c1', borderWidth: 1.5, pointRadius: 0, tension: 0.4, fill: true, backgroundColor: 'rgba(111, 66, 193, 0.1)' }]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        scales: { x: { display: false }, y: { display: false } },
                        plugins: { legend: { display: false }, tooltip: { enabled: false } },
                        animation: { duration: 0 }
                    }
                });
            }
        });
    }

    function startGame() {
      lastKur = state.kur;
      lastEuro = state.euro;
      lastGramAltin = state.gramAltin;
      el.faizOran.value = state.faiz.toFixed(2);

      // Initialize bank and depositor positions if not already set
      if (Object.keys(state.bankaDovizPozisyonlari).length === 0) {
          BANK_NAMES.forEach(bank => {
              state.bankaDovizPozisyonlari[bank] = {
                  usd: 50 + Math.random() * 50, // Million USD
                  eur: 30 + Math.random() * 30, // Million EUR
                  gold: 500 + Math.random() * 500 // Grams of gold
              };
          });
      }

      initCryptoMarketUI();
      gameIntervalId = setInterval(oyunDongusu, 2000); // Main game loop
      newsIntervalId = setInterval(generateNewsEvent, 25000); // Slower news
      tweetIntervalId = setInterval(generateTweetEvent, 12000); // Slower tweets
      updateNewsTicker(true);
      guncelleUI();
      if (DEBUG_MODE) console.log("Game Started with state:", state);
      // Auto-save every 30 seconds
      setInterval(saveUserGameState, 30000);
    }

    function resetGame(isGameOver) {
      const confirmReset = () => {
          stopAllIntervals();
          isGameRunning = false;
          if (currentUser) {
            const users = loadUsers();
            delete users[currentUser].gameState;
            saveUsers(users);
          }
          window.location.reload();
      };
      if (isGameOver) {
          confirmReset();
      } else if (confirm("T√ºm ilerlemeniz silinecek ve oyun yeniden ba≈ülayacak. Emin misiniz?")) {
          confirmReset();
      }
    }

    function stopAllIntervals() {
        clearInterval(gameIntervalId);
        clearInterval(newsIntervalId);
        clearInterval(tweetIntervalId);
        clearInterval(datetimeIntervalId);
        stopAutoSell();
        gameIntervalId = null;
        newsIntervalId = null;
        tweetIntervalId = null;
        datetimeIntervalId = null;
    }

    function showPauseModal() {
      if (!isGameRunning) return;
      isGameRunning = false;
      stopAllIntervals();
      saveUserGameState();
      showModal('pauseModal');
    }

    function resumeGame() {
      if (isGameRunning) return;
      isGameRunning = true;
      closeModal('pauseModal');
      startGame(); // Re-initializes intervals
    }

    // --- GAME OVER ---
    function gameOver(reason) {
        stopAllIntervals();
        isGameRunning = false;
        el.gameOverText.textContent = reason;
        showModal('gameOverScreen');
    }

    function saveScoreAndReset() {
        const playerName = el.playerName.value.trim() || currentUser || "Anonim";

        // This is a placeholder for a real leaderboard system.
        // For now, it just resets the game.
        showNotification(`${playerName} i√ßin skor kaydedildi (sim√ºlasyon)!`, false);
        resetGame(true);
    }

    // --- PLAYER ACTIONS ---
    function dovizSat() {
      const miktar = parseFloat(el.dovizMiktar.value);
      if (isNaN(miktar) || miktar <= 0) {
        showNotification('Ge√ßerli bir miktar girin!', true);
        return;
      }
      if (executeSale(miktar, 'USD')) {
        if (miktar >= 5) state.shockEffectTimer = 15; // Shock effect for large sales
        playSound(el.interventionSound);
        showNotification(`${miktar.toFixed(1)} Milyar $ satƒ±ldƒ±.`, false);
        state.kredibilite -= miktar * 0.1; // Intervention costs credibility
        state.hukumetGuveni -= miktar * 0.05;
      }
    }

    function euroSat() {
        const miktar = parseFloat(el.euroMiktar.value) / 1000; // Convert to Billion Euro
        if (isNaN(miktar) || miktar <= 0) {
            showNotification('Ge√ßerli bir miktar girin!', true);
            return;
        }
        if (executeSale(miktar, 'EUR')) {
            playSound(el.interventionSound);
            showNotification(`${(miktar * 1000).toFixed(1)} Milyon ‚Ç¨ satƒ±ldƒ±.`, false);
            state.kredibilite -= miktar * 0.05;
            state.hukumetGuveni -= miktar * 0.02;
        }
    }

    function altinSat() {
        const miktar = parseFloat(el.altinMiktar.value); // Gram
        if (isNaN(miktar) || miktar <= 0) {
            showNotification('Ge√ßerli bir miktar girin!', true);
            return;
        }
        // Gold sale directly reduces gold reserves, not USD reserves.
        // Assume Central Bank holds physical gold.
        if (state.mevduatSahibiDovizPozisyonlari.gold < miktar) { // Using depositor gold as a proxy for available gold
            showNotification('Altƒ±n satƒ±≈üƒ± i√ßin yeterli altƒ±n rezervi yok!', true);
            return false;
        }
        state.mevduatSahibiDovizPozisyonlari.gold -= miktar; // Reduce available gold
        state.rezerv += (miktar * state.gramAltin) / 1e9; // Add equivalent USD to reserves

        // Direct price impact on gold
        state.gramAltin -= miktar * 0.0001; // Small direct price impact
        state.ceyrekAltin = state.gramAltin * 1.6; // Recalculate based on gram
        state.cumhuriyetAltin = state.gramAltin * 6.5;
        state.yirmiIkiAyarAltin = state.gramAltin * 0.916; // 22 Ayar is 0.916 fine

        playSound(el.interventionSound);
        showNotification(`${miktar.toFixed(0)} Gram altƒ±n satƒ±ldƒ±.`, false);
        addTradeToLog({ time: new Date(), type: 'Altƒ±n Satƒ±≈ü', amount: miktar, actor: 'TCMB', isIntervention: true, rate: state.gramAltin, currency: 'GRAM' });
    }

    function executeSale(miktar, currencyType) {
      let currentRate = 0;
      if (currencyType === 'USD') {
          currentRate = state.kur;
      } else if (currencyType === 'EUR') {
          currentRate = state.euro;
      }

      if (state.rezerv < miktar) {
        stopAutoSell();
        showNotification('Rezervler yetersiz!', true);
        return false;
      }
      state.rezerv -= miktar;
      let etki = miktar * (0.05 + Math.random() * 0.05) * (1 + (state.kredibilite - 50) / 200);
      if (currencyType === 'USD') {
          state.kur -= etki;
          state.piyasaEtkisi -= miktar * 2; // Temporary impact
          addTradeToLog({ time: new Date(), type: 'Dolar Satƒ±≈ü', amount: miktar * 1e9, actor: 'TCMB', isIntervention: true, rate: currentRate, currency: 'USD' });
      } else if (currencyType === 'EUR') {
          state.euro -= etki * 0.8; // Euro impact might be slightly less than USD
          state.piyasaEtkisi -= miktar * 1.5;
          addTradeToLog({ time: new Date(), type: 'Euro Satƒ±≈ü', amount: miktar * 1e9, actor: 'TCMB', isIntervention: true, rate: currentRate, currency: 'EUR' });
      }
      return true;
    }

    function rezervEkle() {
      const now = Date.now() / 1000;
      if (now - lastRezervEkleTime < REZERV_EKLE_COOLDOWN) {
        showNotification(`Dƒ±≈ü finansman i√ßin ${Math.ceil(REZERV_EKLE_COOLDOWN - (now - lastRezervEkleTime))}sn bekleyin!`, true);
        return;
      }
      const talepMiktar = parseFloat(el.rezervEkleMiktar.value);
      if (isNaN(talepMiktar) || talepMiktar <= 0) {
        showNotification('Ge√ßerli bir miktar girin!', true);
        return;
      }
      // Success depends on CDS, credibility, and global risk appetite (VIX)
      const krediEtkisi = 0.5 + (state.kredibilite / 200);
      const cdsEtkisi = Math.max(0.1, 1 - (state.cds - 200) / 500);
      const riskIstahiEtkisi = Math.max(0.2, 1 - (state.vixIndex - 15) / 40);
      const bulunanMiktar = talepMiktar * krediEtkisi * cdsEtkisi * riskIstahiEtkisi * (Math.random() * 0.4 + 0.8);

      state.rezerv += bulunanMiktar;
      state.cds -= bulunanMiktar * 2; // Finding money improves CDS
      state.kredibilite += bulunanMiktar * 0.2;
      lastRezervEkleTime = now;
      playSound(el.buySound);
      showNotification(`${talepMiktar.toFixed(1)} Milyar $ arandƒ±, ${bulunanMiktar.toFixed(1)} Milyar $ bulundu.`, false);
    }

    function startAutoSell() {
        if (autoSellIntervalId) return;
        const miktar = parseFloat(el.otoDovizMiktar.value);
        if (isNaN(miktar) || miktar <= 0) {
            showNotification('Ge√ßerli bir otomatik satƒ±≈ü miktarƒ± girin!', true);
            return;
        }
        el.otoSatBaslat.disabled = true;
        el.otoSatDurdur.disabled = false;
        autoSellIntervalId = setInterval(() => {
            if (!executeSale(miktar, 'USD')) {
                stopAutoSell();
            }
        }, 5000);
        showNotification('Otomatik satƒ±≈ü ba≈üladƒ±.', false);
    }

    function stopAutoSell() {
        if (autoSellIntervalId) {
            clearInterval(autoSellIntervalId);
            autoSellIntervalId = null;
            el.otoSatBaslat.disabled = false;
            el.otoSatDurdur.disabled = true;
            showNotification('Otomatik satƒ±≈ü durduruldu.', false);
        }
    }

    function faizDegistir() {
      if (!state.isPpkDay) return;
      const yeniFaiz = parseFloat(el.faizOran.value);
      if (isNaN(yeniFaiz) || yeniFaiz < 0) {
        showNotification('Ge√ßerli bir faiz oranƒ± girin!', true);
        return;
      }
      const degisim = yeniFaiz - state.faiz;
      let kredibiliteDegisim = 0;
      let hukumetGuveniDegisim = 0;

      // Kredibilite etkisi (s√∂zl√º y√∂nlendirmeye uyum)
      if (state.piyasaYonlendirmesi === 'sahin' && degisim < 2.5) {
        kredibiliteDegisim = -15;
        updateNewsTicker(false, `Pƒ∞YASALAR HAYAL KIRIKLIƒûI! TCMB, '≈üahin' mesajƒ±na raƒümen bekleneni vermedi.`, 'red');
      } else if (state.piyasaYonlendirmesi === 'guvercin' && degisim > 0) {
        kredibiliteDegisim = -10;
        updateNewsTicker(false, `Pƒ∞YASALAR ≈ûA≈ûKIN! TCMB, 'g√ºvercin' mesajdan sonra faiz artƒ±rdƒ±.`, 'red');
      } else if (Math.abs(degisim) > 0) {
         kredibiliteDegisim = 5 + Math.abs(degisim); // Kararlƒ± adƒ±m kredibiliteyi artƒ±rƒ±r
      }

      // H√ºk√ºmet g√ºveni etkisi (b√ºy√ºme odaklƒ±)
      if (degisim > 2.5) hukumetGuveniDegisim = -10;
      else if (degisim < -2.5) hukumetGuveniDegisim = 15;
      else hukumetGuveniDegisim = 2;

      state.kredibilite += kredibiliteDegisim;
      state.hukumetGuveni += hukumetGuveniDegisim;
      state.faiz = yeniFaiz;
      state.isPpkDay = false;
      el.faizBtn.disabled = true;
      showNotification(`Yeni politika faizi %${yeniFaiz.toFixed(2)} olarak belirlendi.`, false);
      // Karar sonrasƒ± piyasa etkisi
      state.piyasaEtkisi += degisim * 2;
    }

    function toggleKKM() {
        state.kkmActive = !state.kkmActive;
        if(state.kkmActive) {
            showNotification("KKM Sistemi Aktif Edildi. Kur artƒ±≈üƒ± Hazine'ye y√ºk bindirecek.", false);
            el.kkmBtn.textContent = "KKM Sistemini Pasif Et";
            el.kkmBtn.classList.remove('btn-purple');
            el.kkmBtn.classList.add('btn-sell');
            state.kredibilite -= 10; // KKM unorthodox bir politika olarak g√∂r√ºl√ºr.
        } else {
            showNotification("KKM Sistemi Devre Dƒ±≈üƒ± Bƒ±rakƒ±ldƒ±. D√∂viz talebi artabilir.", true);
            el.kkmBtn.textContent = "KKM Sistemini Aktif Et";
            el.kkmBtn.classList.add('btn-purple');
            el.kkmBtn.classList.remove('btn-sell');
            state.kredibilite += 10;
            state.dovizTasarrufSeviyesi += 5; // KKM'den √ßƒ±kan d√∂vize y√∂nelebilir
        }
    }

    function changeZK(change) {
        const yeniZk = state.zorunluKarsilik + change;
        if (yeniZk >= 1 && yeniZk <= 20) {
            state.zorunluKarsilik = yeniZk;
            showNotification(`Zorunlu kar≈üƒ±lƒ±klar %${yeniZk.toFixed(1)} olarak ayarlandƒ±.`, false);
            // ZK artƒ±≈üƒ± likiditeyi sƒ±kar, talebi d√º≈ü√ºr√ºr, kur √ºzerinde hafif baskƒ± azaltƒ±r.
            state.talepEndeksi -= change * 2;
            state.piyasaEtkisi -= change;
        } else {
            showNotification('Zorunlu kar≈üƒ±lƒ±k sƒ±nƒ±rlar (%1-%20) dƒ±≈üƒ±na √ßƒ±kamaz.', true);
        }
    }

    function applyCapitalControls() {
        if(confirm("SERMAYE KONTROLLERƒ∞ son √ßaredir ve ekonomiyi uzun yƒ±llar etkileyecek aƒüƒ±r sonu√ßlarƒ± olur. Bu, oyunu bitirir. Emin misiniz?")) {
            state.sermayeKontrolu = true;
            gameOver("Sermaye kontrolleri uygulandƒ±. Piyasalar kapandƒ± ve yabancƒ± yatƒ±rƒ±cƒ±lar √ºlkeden ka√ßtƒ±. G√∂revinizde ba≈üarƒ±sƒ±z oldunuz.");
        }
    }

    function setGuidance(type) {
        state.piyasaYonlendirmesi = type;
        const messages = {
            sahin: '≈ûahin y√∂nlendirme verildi. Piyasalar faiz artƒ±≈üƒ± bekliyor.',
            guvercin: 'G√ºvercin y√∂nlendirme verildi. Piyasalar faiz indirimi veya sabit kalmasƒ±nƒ± bekliyor.',
            notr: 'N√∂tr y√∂nlendirme verildi. Piyasalar belirsizlik i√ßinde.'
        };
        showNotification(messages[type], false);
        closeModal('forwardGuidanceModal');
    }

    function adjustTax(type, change) {
        const keyMap = { kdv: 'kdvOrani', gelir: 'gelirVergiOrani', kurumlar: 'kurumlarVergiOrani' };
        const targetKey = keyMap[type];
        if (state[targetKey] + change >= 5 && state[targetKey] + change <= 40) {
            state[targetKey] += change;
            // Vergi artƒ±≈üƒ± talebi d√º≈ü√ºr√ºr, b√ºt√ßeyi iyile≈ütirir ama h√ºk√ºmet g√ºvenini azaltƒ±r
            state.talepEndeksi -= change * 1.5;
            state.butceDengesiGSYIHOrani += change * 0.2;
            state.hukumetGuveni -= change * 1;
            showNotification(`${type.toUpperCase()} oranƒ± %${state[targetKey].toFixed(1)} oldu.`, false);
        } else {
            showNotification('Vergi oranlarƒ± mantƒ±klƒ± sƒ±nƒ±rlar i√ßinde kalmalƒ±dƒ±r.', true);
        }
    }

    function changeGreyEconomyPolicy(type) {
        if (type === 'sikilastir') {
            state.griEkonomiOrani -= 0.5;
            state.butceDengesiGSYIHOrani += 0.1; // Vergi geliri artar
            state.hukumetGuveni -= 1; // Pop√ºler olmayan bir karar
            showNotification('Kayƒ±t dƒ±≈üƒ± ekonomiyle m√ºcadele sƒ±kƒ±la≈ütƒ±rƒ±ldƒ±.', false);
        } else {
            state.griEkonomiOrani += 0.5;
            state.hukumetGuveni += 1;
            showNotification('Kayƒ±t dƒ±≈üƒ± ekonomi denetimleri gev≈üetildi.', false);
        }
        state.griEkonomiOrani = Math.max(10, Math.min(50, state.griEkonomiOrani));
    }

    function setMigrationPolicy(type) {
        const miktar = parseFloat(el.gocPolitikasiMiktar.value) / 1000; // Bin ki≈üiyi milyona √ßevir
        if (isNaN(miktar) || miktar <= 0) {
            showNotification('Ge√ßerli bir miktar girin.', true);
            return;
        }

        if (type === 'cekici') {
            state.netGoc += miktar;
            showNotification(`Nitelikli g√∂√ßmenler i√ßin te≈üvik programƒ± ba≈ülatƒ±ldƒ±.`, false);
        } else {
            state.netGoc -= miktar;
            showNotification(`G√∂√ß politikalarƒ± sƒ±kƒ±la≈ütƒ±rƒ±ldƒ±.`, false);
        }
    }

    function investInEducation() {
        if(state.rezerv > 2) {
            state.rezerv -= 2; // Sembolik maliyet
            state.egitimSeviyesi += 1;
            state.hukumetGuveni += 2;
            showNotification("Eƒüitime 2 Milyar $ yatƒ±rƒ±m yapƒ±ldƒ±. Uzun vadede verimlilik artacak.", false);
        } else {
            showNotification("Yatƒ±rƒ±m i√ßin yeterli rezerv yok.", true);
        }
    }

    function investInHealthcare() {
         if(state.rezerv > 2) {
            state.rezerv -= 2; // Sembolik maliyet
            state.saglikSeviyesi += 1;
            state.hukumetGuveni += 2;
            showNotification("Saƒülƒ±k sistemine 2 Milyar $ yatƒ±rƒ±m yapƒ±ldƒ±.", false);
        } else {
            showNotification("Yatƒ±rƒ±m i√ßin yeterli rezerv yok.", true);
        }
    }

    function adjustFiscalPolicy(type, change) {
        if(type === 'harcama') {
            state.kamuHarcamalari += change;
            state.talepEndeksi += change * 2;
            state.buyume += change * 0.5;
            state.butceDengesiGSYIHOrani -= change * 0.5;
            state.hukumetGuveni += change * 4;
            showNotification(`Kamu harcamalarƒ± deƒüi≈ütirildi.`, false);
        } else { // vergi
            state.vergiOrani += change;
            state.talepEndeksi -= change * 10;
            state.butceDengesiGSYIHOrani += change * 2;
            state.hukumetGuveni -= change * 20;
            showNotification(`Genel vergi oranlarƒ± deƒüi≈ütirildi.`, false);
        }
    }

    function launchInfrastructureProject() {
        if(state.rezerv > 10) {
            state.rezerv -= 10;
            state.kamuHarcamalari += 1;
            state.buyume += 0.5;
            state.talepEndeksi += 5;
            state.hukumetGuveni += 5;
            state.cds -= 5;
            showNotification("B√ºy√ºk altyapƒ± projesi ba≈ülatƒ±ldƒ±. B√ºy√ºme ve talep canlandƒ±.", false);
        } else {
            showNotification("Proje i√ßin yeterli rezerv yok.", true);
        }
    }

    function applyMacroPru(type) {
        if(type === 'limit_consumer_credit') {
            state.talepEndeksi -= 5;
            state.buyume -= 0.2;
            state.enflasyonBeklentisi -= 1;
            state.kredibilite += 2;
            showNotification("T√ºketici kredileri sƒ±kƒ±la≈ütƒ±rƒ±ldƒ±. Talep yava≈ülayacak.", false);
        }
    }

    function buyCrypto(id) {
        const dolarAmount = parseFloat(document.getElementById(`${id}-amount`).value);
        if (isNaN(dolarAmount) || dolarAmount <= 0) {
            showNotification("Ge√ßerli bir Dolar miktarƒ± girin.", true);
            return;
        }
        if (state.rezerv < dolarAmount / 1e9) { // Milyar $ kontrol√º
            showNotification("Kripto almak i√ßin yeterli Dolar rezervi yok.", true);
            return;
        }

        const cryptoPrice = state.kriptolar[id].price;
        const cryptoAmount = dolarAmount / cryptoPrice;
        state.rezerv -= dolarAmount / 1e9;
        state.kriptolar[id].amount += cryptoAmount;

        showNotification(`${cryptoAmount.toFixed(4)} ${id.toUpperCase()} alƒ±ndƒ±.`, false);
        playSound(el.buySound);
    }

    function sellCrypto(id) {
        const dolarAmount = parseFloat(document.getElementById(`${id}-amount`).value);
        if (isNaN(dolarAmount) || dolarAmount <= 0) {
            showNotification("Ge√ßerli bir Dolar miktarƒ± girin.", true);
            return;
        }

        const cryptoPrice = state.kriptolar[id].price;
        const cryptoToSell = dolarAmount / cryptoPrice;
        if (state.kriptolar[id].amount < cryptoToSell) {
            showNotification(`Yeterli ${id.toUpperCase()} yok.`, true);
            return;
        }

        state.kriptolar[id].amount -= cryptoToSell;
        state.rezerv += dolarAmount / 1e9;
        showNotification(`${cryptoToSell.toFixed(4)} ${id.toUpperCase()} satƒ±ldƒ±.`, false);
        playSound(el.sellSound);
    }

    // --- SALARY & PENSION POLICIES ---
    function adjustSalary(type) {
        const inputId = `memurMaas${type.charAt(0).toUpperCase() + type.slice(1)}`;
        const newSalary = parseFloat(el[inputId].value);
        if (isNaN(newSalary) || newSalary < 0) {
            showNotification('Ge√ßerli bir maa≈ü deƒüeri girin!', true);
            return;
        }
        const oldSalary = state.memurMaaslari[type];
        const change = newSalary - oldSalary;
        state.memurMaaslari[type] = newSalary;

        // Impact on budget and government trust
        state.butceDengesiGSYIHOrani -= (change / 10000) * 0.01; // Rough estimate
        state.hukumetGuveni += (change / 1000) * 0.5; // Positive for increases
        state.talepEndeksi += (change / 1000) * 0.1; // Increased salaries, increased demand
        state.enflasyonBeklentisi += (change / 1000) * 0.05; // Inflationary pressure

        showNotification(`${type.charAt(0).toUpperCase() + type.slice(1)} maa≈üƒ± ${newSalary.toFixed(0)}‚Ç∫ olarak ayarlandƒ±.`, false);
    }

    function adjustPension(type) {
        const inputId = `emekliMaas${type.charAt(0).toUpperCase() + type.slice(1)}`;
        const newPension = parseFloat(el[inputId].value);
        if (isNaN(newPension) || newPension < 0) {
            showNotification('Ge√ßerli bir aylƒ±k deƒüeri girin!', true);
            return;
        }
        const oldPension = state.emekliMaaslari[type];
        const change = newPension - oldPension;
        state.emekliMaaslari[type] = newPension;

        // Impact on budget and government trust
        state.butceDengesiGSYIHOrani -= (change / 10000) * 0.02; // Rough estimate, more impact due to larger base
        state.hukumetGuveni += (change / 1000) * 0.8; // More positive impact on trust
        state.talepEndeksi += (change / 1000) * 0.15; // Increased pensions, increased demand
        state.enflasyonBeklentisi += (change / 1000) * 0.08; // Inflationary pressure

        showNotification(`${type === 'enDusuk' ? 'En d√º≈ü√ºk emekli aylƒ±ƒüƒ±' : type.toUpperCase() + ' emekli aylƒ±ƒüƒ±'} ${newPension.toFixed(0)}‚Ç∫ olarak ayarlandƒ±.`, false);
    }

    // --- PUBLIC STATEMENT ---
    function makePublicStatement() {
        const statement = el.publicStatementText.value.trim();
        if (!statement) {
            showNotification('L√ºtfen bir a√ßƒ±klama girin.', true);
            return;
        }

        const now = Date.now();
        const timeSinceLastStatement = (now - state.lastStatementTime) / 1000; // seconds

        // Calculate hash of the statement to check for repetition
        const statementHash = btoa(unescape(encodeURIComponent(statement))); // Simple hash

        let impactMultiplier = 1;
        if (statementHash === state.publicStatementImpact.lastHash && timeSinceLastStatement < 60) {
            impactMultiplier = 0.5; // Repeated statement too soon
            showNotification('Aynƒ± a√ßƒ±klama kƒ±sa s√ºrede tekrarlandƒ±, etkisi azalacak.', true);
        } else if (timeSinceLastStatement < 10) {
            impactMultiplier = 0.7; // Too frequent statements
            showNotification('√áok sƒ±k a√ßƒ±klama yapƒ±yorsunuz, etkisi azalacak.', true);
        }

        state.publicStatement = statement;
        state.lastStatementTime = now;
        state.publicStatementImpact.lastHash = statementHash;
        // Analyze sentiment and keywords
        let credibilityChange = 0;
        let trustChange = 0;
        let dollarizationChange = 0;
        let fxEffect = 0; // Direct FX impact

        const keywords = {
            positive: ['enflasyon d√º≈üecek', 'istikrar', 'g√ºven', 'b√ºy√ºme', 'rezerv artacak', 'd√∂viz satalƒ±m', 'yatƒ±rƒ±m', '≈üeffaf', 'reform', 'g√º√ßl√º'],
            negative: ['sƒ±kƒ±ntƒ±', 'zorlu s√ºre√ß', 'kriz', 'sermaye kontrol√º', 'd√∂viz alalƒ±m', 'risk', 'belirsizlik', 'zayƒ±f', 'yolsuzluk'],
            neutral: ['veriye dayalƒ±', 'temkinli', 'piyasalarƒ± izliyoruz', 'deƒüerlendiriyoruz', 'normalle≈üme']
        };
        let sentiment = 'neutral';
        let matchedKeywords = [];

        for (const key in keywords) {
            keywords[key].forEach(word => {
                if (statement.toLowerCase().includes(word)) {
                    matchedKeywords.push({ word, sentiment: key });
                }
            });
        }

        if (matchedKeywords.length > 0) {
            const positiveMatches = matchedKeywords.filter(k => k.sentiment === 'positive').length;
            const negativeMatches = matchedKeywords.filter(k => k.sentiment === 'negative').length;

            if (positiveMatches > negativeMatches) sentiment = 'positive';
            else if (negativeMatches > positiveMatches) sentiment = 'negative';
        }

        switch (sentiment) {
            case 'positive':
                credibilityChange = 5 + Math.random() * 5;
                trustChange = 5 + Math.random() * 5;
                dollarizationChange = -2 - Math.random() * 2; // Encourages selling FX
                fxEffect = -0.05 - Math.random() * 0.05; // Strengthens TL
                break;
            case 'negative':
                credibilityChange = -5 - Math.random() * 5;
                trustChange = -5 - Math.random() * 5;
                dollarizationChange = 2 + Math.random() * 2; // Encourages buying FX
                fxEffect = 0.05 + Math.random() * 0.05; // Weakens TL
                break;
            default: // Neutral or no strong keywords
                credibilityChange = -1 + Math.random() * 2;
                trustChange = -1 + Math.random() * 2;
                dollarizationChange = 0;
                fxEffect = 0;
                break;
        }

        // Apply diminishing returns
        state.publicStatementImpact.credibility = credibilityChange * impactMultiplier;
        state.publicStatementImpact.trust = trustChange * impactMultiplier;
        state.publicStatementImpact.dollarization = dollarizationChange * impactMultiplier;
        state.publicStatementImpact.fxEffect = fxEffect * impactMultiplier;
        updateNewsTicker(false, `BA≈ûKAN A√áIKLAMASI: "${statement}"`, sentiment === 'positive' ? 'green' : (sentiment === 'negative' ? 'red' : ''));
        showNotification('A√ßƒ±klamanƒ±z piyasalara iletildi.', false);
    }

    // --- ADVISOR ---
    function showAdvisorSuggestion() {
        // Implement advisor logic here
        showNotification("Danƒ±≈ümanƒ±nƒ±z ≈üu an me≈ügul.", true);
    }

    // --- LEADERBOARD ---
    function showLeaderboard() {
        // Implement leaderboard logic here
        showNotification("Liderlik tablosu yakƒ±nda...", false);
    }

    // --- DARK MODE TOGGLE ---
    function toggleDarkMode() {
        document.body.classList.toggle('dark-mode');
        if (document.body.classList.contains('dark-mode')) {
            localStorage.setItem('darkMode', 'enabled');
        } else {
            localStorage.removeItem('darkMode');
        }
        // Re-render charts to adapt to new theme colors if necessary
        createMainChart();
        initCryptoCharts();
        guncelleUI(); // To update text colors etc.
    }

    // --- CORE GAME LOOP ---
    function oyunDongusu(isAfkSimulation = false) {
      if (!isGameRunning && !isAfkSimulation) return;
      const now = new Date();
      let kurDegisim = 0;
      let euroDegisim = 0;
      let onsAltinDegisim = 0;

      // Hƒ±z fakt√∂r√º: Bu deƒüeri deƒüi≈ütirerek oyunun genel hƒ±zƒ±nƒ± ayarlayabilirsiniz.
      // Daha k√º√ß√ºk bir deƒüer, daha yava≈ü deƒüi≈üim anlamƒ±na gelir.
      const speedFactor = 0.005; 

      // 1. Enflasyon ve Faiz Farkƒ±
      const reelFaizFarki = (state.faiz - state.enflasyon) - 2.0; // 2.0: Global ortalama reel faiz (tahmini)
      kurDegisim -= reelFaizFarki * 0.0005 * state.difficulty * speedFactor; /* Deƒüi≈üim hƒ±zƒ± azaltƒ±ldƒ± */
      euroDegisim -= reelFaizFarki * 0.0004 * state.difficulty * speedFactor; /* Deƒüi≈üim hƒ±zƒ± azaltƒ±ldƒ± */

      // 2. CDS Primi Etkisi
      kurDegisim += (state.cds - 400) * 0.00001 * state.difficulty * speedFactor; /* Deƒüi≈üim hƒ±zƒ± azaltƒ±ldƒ± */
      euroDegisim += (state.cds - 400) * 0.000008 * state.difficulty * speedFactor; /* Deƒüi≈üim hƒ±zƒ± azaltƒ±ldƒ± */

      // 3. Cari A√ßƒ±k Etkisi
      kurDegisim += Math.abs(state.cariAcik) * 0.0005 * state.difficulty * speedFactor; /* Deƒüi≈üim hƒ±zƒ± azaltƒ±ldƒ± */
      euroDegisim += Math.abs(state.cariAcik) * 0.0004 * state.difficulty * speedFactor; /* Deƒüi≈üim hƒ±zƒ± azaltƒ±ldƒ± */

      // 4. Global Risk ƒ∞≈ütahƒ± (VIX)
      kurDegisim += (state.vixIndex - 15) * 0.0002 * state.difficulty * speedFactor; /* Deƒüi≈üim hƒ±zƒ± azaltƒ±ldƒ± */
      euroDegisim += (state.vixIndex - 15) * 0.00015 * state.difficulty * speedFactor; /* Deƒüi≈üim hƒ±zƒ± azaltƒ±ldƒ± */
      onsAltinDegisim -= (state.vixIndex - 15) * 0.01 * speedFactor; /* Deƒüi≈üim hƒ±zƒ± azaltƒ±ldƒ± */ // Higher VIX -> lower gold (flight to safety USD)

      // 5. Piyasa Etkisi (M√ºdahaleler, Faiz Kararlarƒ± vb.)
      kurDegisim += state.piyasaEtkisi * 0.001 * speedFactor; /* Deƒüi≈üim hƒ±zƒ± azaltƒ±ldƒ± */
      euroDegisim += state.piyasaEtkisi * 0.0008 * speedFactor; /* Deƒüi≈üim hƒ±zƒ± azaltƒ±ldƒ± */
      state.piyasaEtkisi *= 0.95; // Etki zamanla daha yava≈ü azalƒ±r

      // 6. Kredibilite Etkisi
      kurDegisim -= (state.kredibilite - 50) * 0.00005 * speedFactor; /* Deƒüi≈üim hƒ±zƒ± azaltƒ±ldƒ± */
      euroDegisim -= (state.kredibilite - 50) * 0.00004 * speedFactor; /* Deƒüi≈üim hƒ±zƒ± azaltƒ±ldƒ± */

      // 7. Rastgele Volatilite
      kurDegisim += (Math.random() - 0.5) * 0.005 * state.difficulty * speedFactor; /* Deƒüi≈üim hƒ±zƒ± azaltƒ±ldƒ± */
      euroDegisim += (Math.random() - 0.5) * 0.004 * state.difficulty * speedFactor; /* Deƒüi≈üim hƒ±zƒ± azaltƒ±ldƒ± */
      onsAltinDegisim += (Math.random() - 0.5) * 0.2 * speedFactor; /* Deƒüi≈üim hƒ±zƒ± azaltƒ±ldƒ± */ // Random gold volatility

      // 8. Public Statement Impact
      kurDegisim += state.publicStatementImpact.fxEffect * speedFactor; /* Etki hƒ±zƒ± azaltƒ±ldƒ± */
      euroDegisim += state.publicStatementImpact.fxEffect * 0.8 * speedFactor; /* Etki hƒ±zƒ± azaltƒ±ldƒ± */
      state.kredibilite += state.publicStatementImpact.credibility * 0.01; /* Etki hƒ±zƒ± azaltƒ±ldƒ± */
      state.hukumetGuveni += state.publicStatementImpact.trust * 0.01; /* Etki hƒ±zƒ± azaltƒ±ldƒ± */
      state.dovizTasarrufSeviyesi += state.publicStatementImpact.dollarization * 0.01; /* Etki hƒ±zƒ± azaltƒ±ldƒ± */
      // Reset statement impact after applying
      state.publicStatementImpact.credibility *= 0.99; /* Daha yava≈ü sƒ±fƒ±rlama */
      state.publicStatementImpact.trust *= 0.99; /* Daha yava≈ü sƒ±fƒ±rlama */
      state.publicStatementImpact.dollarization *= 0.99; /* Daha yava≈ü sƒ±fƒ±rlama */
      state.publicStatementImpact.fxEffect *= 0.99; /* Daha yava≈ü sƒ±fƒ±rlama */

      // KKM aktif ise kur daha volatil olur
      if (state.kkmActive) {
          kurDegisim *= 1.1; /* Volatilite biraz azaltƒ±ldƒ± */
          euroDegisim *= 1.1; /* Volatilite biraz azaltƒ±ldƒ± */
      }

      state.kur += kurDegisim;
      state.kur = Math.max(state.kur, 1.0); // Kur 1'in altƒ±na d√º≈üemez

      state.euro += euroDegisim;
      state.euro = Math.max(state.euro, 1.0);

      state.onsAltin += onsAltinDegisim;
      state.onsAltin = Math.max(state.onsAltin, 1000); // Ons altƒ±n 1000 dolarƒ±n altƒ±na d√º≈ümesin

      // --- Diƒüer G√∂stergelerin G√ºncellenmesi ---
      const kurArtisOrani = (state.kur - lastKur) / lastKur;
      const euroArtisOrani = (state.euro - lastEuro) / lastEuro;

      // Altƒ±n Fiyatlarƒ± (TL cinsinden)
      // Gram Altƒ±n = Ons Altƒ±n * Dolar/TL / 31.1035 (gram per troy ounce) + Premium
      state.gramAltin = (state.onsAltin * state.kur / 31.1035) * (1 + (Math.random() * 0.0005 - 0.0002)); /* Volatilite azaltƒ±ldƒ± */ // Local premium/discount
      state.ceyrekAltin = state.gramAltin * 1.6; // ~1.6 gram gold in quarter
      state.cumhuriyetAltin = state.gramAltin * 6.5; // ~6.5 gram gold in republic
      state.yirmiIkiAyarAltin = state.gramAltin * 0.916; // 22 Ayar = 0.916 fine gold

      // Enflasyon
      let enflasyonDegisim = kurArtisOrani * 5; /* Kur ge√ßi≈ükenliƒüi azaltƒ±ldƒ± */ // Kur ge√ßi≈ükenliƒüi
      enflasyonDegisim += (state.talepEndeksi - 100) * 0.005; /* Talep enflasyonu etkisi azaltƒ±ldƒ± */ // Talep enflasyonu
      enflasyonDegisim += (state.enflasyonBeklentisi - state.enflasyon) * 0.001; /* Beklentilere yakƒ±nsama hƒ±zƒ± azaltƒ±ldƒ± */ // Beklentilere yakƒ±nsama

      // Maa≈ü ve emekli aylƒ±ƒüƒ± artƒ±≈ülarƒ±nƒ±n enflasyonist etkisi
      const totalSalaryImpact = (state.memurMaaslari.polis + state.memurMaaslari.asker + state.memurMaaslari.belediye) / 100000;
      const totalPensionImpact = (state.emekliMaaslari.sgk + state.emekliMaaslari.bagkur + state.emekliMaaslari.enDusuk) / 100000;
      enflasyonDegisim += (totalSalaryImpact + totalPensionImpact) * 0.0001; /* Etki azaltƒ±ldƒ± */ // Small but persistent effect

      state.enflasyon += enflasyonDegisim;
      // Enflasyon Beklentisi (daha yava≈ü deƒüi≈üir)
      state.enflasyonBeklentisi += (state.enflasyon - state.enflasyonBeklentisi) * 0.0005 * (1 - state.kredibilite/200); /* Hƒ±z azaltƒ±ldƒ± */
      // B√ºy√ºme
      let buyumeDegisim = (state.faiz - 50) * -0.001; /* Etki azaltƒ±ldƒ± */
      buyumeDegisim += (state.kamuHarcamalari - 15) * 0.001; /* Etki azaltƒ±ldƒ± */
      buyumeDegisim += (kurArtisOrani > 0 ? -kurArtisOrani * 1 : 0); /* Y√ºksek kur b√ºy√ºmeyi baskƒ±lama etkisi azaltƒ±ldƒ± */ // Y√ºksek kur b√ºy√ºmeyi baskƒ±lar
      state.buyume += buyumeDegisim;
      state.buyume = Math.max(-10, Math.min(10, state.buyume));
      // CDS
      let cdsDegisim = (state.enflasyon - 70) * 0.05; /* Etki azaltƒ±ldƒ± */
      cdsDegisim += (40 - state.rezerv) * 0.1; /* Etki azaltƒ±ldƒ± */
      cdsDegisim += (50 - state.kredibilite) * 0.1; /* Etki azaltƒ±ldƒ± */
      cdsDegisim += (50 - state.hukumetGuveni) * 0.05; /* Etki azaltƒ±ldƒ± */
      state.cds += cdsDegisim;
      state.cds = Math.max(150, Math.min(2000, state.cds));
      // Cari A√ßƒ±k (Petrol ve kurdan etkilenir)
      state.cariAcik -= kurArtisOrani * 1; /* Etki azaltƒ±ldƒ± */
      state.cariAcik -= (state.brentFiyati - 85) * 0.001; /* Etki azaltƒ±ldƒ± */
      state.cariAcik += (state.buyume - 1.5) * 0.01; /* Etki azaltƒ±ldƒ± */ // B√ºy√ºme ithalatƒ± artƒ±rƒ±r
      state.cariAcik = Math.min(5, Math.max(-15, state.cariAcik));
      // Rezerv (Cari a√ßƒ±ktan erir)
      state.rezerv += (state.cariAcik / 12 / 15) * 0.4; /* Erime hƒ±zƒ± azaltƒ±ldƒ± */ // Aylƒ±k cari a√ßƒ±ƒüƒ±n saniyelik etkisi

      // KKM Y√ºk√º
      if (state.kkmActive && kurArtisOrani > 0) {
        state.kkmYuku += kurArtisOrani * 5 * state.difficulty; /* Etki azaltƒ±ldƒ± */ // KKM'deki para (tahmini) * kur artƒ±≈üƒ±
        state.butceDengesiGSYIHOrani -= kurArtisOrani * 0.01; /* Etki azaltƒ±ldƒ± */
      }

      // H√ºk√ºmet G√ºveni
      state.hukumetGuveni -= (state.faiz - 40) * 0.005; /* Etki azaltƒ±ldƒ± */ // Y√ºksek faiz sevmez
      state.hukumetGuveni += state.buyume * 0.01; /* Etki azaltƒ±ldƒ± */
      state.hukumetGuveni = Math.max(0, Math.min(100, state.hukumetGuveni));
      // Kredibilite
      if (Math.abs(state.enflasyon - state.enflasyonBeklentisi) > 10) {
        state.kredibilite -= 0.01; /* Etki azaltƒ±ldƒ± */
      }
      state.kredibilite = Math.max(0, Math.min(100, state.kredibilite));
      // Akaryakƒ±t Fiyatlarƒ±
      state.benzinFiyati = (state.brentFiyati * state.kur / 200) + (state.kdvOrani * 0.2);
      state.dizelFiyati = (state.brentFiyati * state.kur / 210) + (state.kdvOrani * 0.2);
      state.lpgFiyati = (state.brentFiyati * state.kur / 400) + (state.kdvOrani * 0.1);
      // Global Piyasalar (hafif dalgalanma)
      state.brentFiyati += (Math.random() - 0.5) * 0.05; /* Dalgalanma azaltƒ±ldƒ± */
      state.vixIndex += (Math.random() - 0.5) * 0.02; /* Dalgalanma azaltƒ±ldƒ± */

      // Kripto Piyasasƒ±
      const btcMove = (Math.random() - 0.5 + (15 - state.vixIndex) * 0.001) * CRYPTO_CONFIG[0].volatility * 0.1; /* Volatilite azaltƒ±ldƒ± */
      CRYPTO_CONFIG.forEach(crypto => {
        const move = btcMove * crypto.correlation + (Math.random() - 0.5) * crypto.volatility * 0.05; /* Volatilite azaltƒ±ldƒ± */
        state.kriptolar[crypto.id].price *= (1 + move);
        state.kriptolar[crypto.id].history.push({ time: now, price: state.kriptolar[crypto.id].price });
        if (state.kriptolar[crypto.id].history.length > 50) state.kriptolar[crypto.id].history.shift();
      });
      // D√∂vizle≈üme (Doviz Tasarruf Seviyesi)
      // Y√ºksek enflasyon, d√º≈ü√ºk faiz, d√º≈ü√ºk kredibilite, y√ºksek kur artƒ±≈üƒ± d√∂vizle≈ümeyi artƒ±rƒ±r
      let dovizlesmeTrend = 0;
      dovizlesmeTrend += (state.enflasyon - state.faiz) * 0.001; /* Etki azaltƒ±ldƒ± */
      dovizlesmeTrend -= (state.kredibilite - 50) * 0.002; /* Etki azaltƒ±ldƒ± */
      dovizlesmeTrend += kurArtisOrani * 10; /* Etki azaltƒ±ldƒ± */
      state.dovizTasarrufSeviyesi += dovizlesmeTrend * 0.001; /* Hƒ±z azaltƒ±ldƒ± */
      state.dovizTasarrufSeviyesi = Math.max(10, Math.min(90, state.dovizTasarrufSeviyesi));
      // Simulate Bank and Depositor Trading
      simulateBankTrading();
      simulateDepositorTrading();
      // PPK Geri Sayƒ±m
      state.ppkDayCountdown -= 2;
      if (state.ppkDayCountdown <= 0 && !state.isPpkDay) {
        state.isPpkDay = true;
        state.ppkDayCountdown = PPK_CYCLE;
        el.faizBtn.disabled = false;
        if (!isAfkSimulation) showModal('forwardGuidanceModal');
      }

      // --- Grafikleri ve UI'ƒ± g√ºncelle ---
      state.kurGecmisi.push(state.kur);
      state.zamanGecmisi.push(now);
      if (state.kurGecmisi.length > 150) {
        state.kurGecmisi.shift();
        state.zamanGecmisi.shift();
      }

      lastKur = state.kur;
      lastEuro = state.euro;
      lastGramAltin = state.gramAltin;
      if (!isAfkSimulation) {
        guncelleUI();
        saveUserGameState();
      }

      // Oyun Biti≈ü Kontrol√º
      if (state.rezerv < -50) {
          gameOver("Net rezervler kritik seviyenin altƒ±na d√º≈üt√º. √úlke temerr√ºde s√ºr√ºklendi.");
      }
      if (state.cds > 1500) {
          gameOver("CDS primi rekor seviyeye ula≈ütƒ±. G√ºven tamamen kayboldu.");
      }
    }

    // --- MARKET PARTICIPANT SIMULATION ---
    function simulateBankTrading() {
        BANK_NAMES.forEach(bankName => {
            const bank = state.bankaDovizPozisyonlari[bankName];
            if (!bank) return;

            // Banks react to interest rate differentials and expected FX movements
            const interestRateDiff = state.faiz - 20; // Compare to a hypothetical global rate
            const kurExpectation = (state.kur - lastKur) > 0 ? 'increase' : 'decrease'; // Simple expectation

            // USD Trading
            let usdTradeAmount = 0; // Million USD
            if (interestRateDiff > 5 && kurExpectation === 'decrease') { // High local rate, stable/falling USD
                usdTradeAmount = -(Math.random() * 0.5 + 0.1); // Sell USD, miktar azaltƒ±ldƒ±
            } else if (interestRateDiff < -5 && kurExpectation === 'increase') { // Low local rate, rising USD
                usdTradeAmount = (Math.random() * 0.5 + 0.1); // Buy USD, miktar azaltƒ±ldƒ±
            }

            // EUR Trading (similar logic)
            let eurTradeAmount = 0; // Million EUR
            if (interestRateDiff > 4 && kurExpectation === 'decrease') {
                eurTradeAmount = -(Math.random() * 0.3 + 0.05); // Sell EUR, miktar azaltƒ±ldƒ±
            } else if (interestRateDiff < -4 && kurExpectation === 'increase') {
                eurTradeAmount = (Math.random() * 0.3 + 0.05); // Buy EUR, miktar azaltƒ±ldƒ±
            }

            // Gold Trading
            let goldTradeAmount = 0; // Grams
            if (state.enflasyon > 80 && kurExpectation === 'increase') { // High inflation, rising FX -> buy gold
                goldTradeAmount = (Math.random() * 50 + 10); // Miktar azaltƒ±ldƒ±
            } else if (state.enflasyon < 50 && kurExpectation === 'decrease') { // Low inflation, falling FX -> sell gold
                goldTradeAmount = -(Math.random() * 50 + 10); // Miktar azaltƒ±ldƒ±
            }

            // Execute trades (banks trade with the market, affecting overall rates)
            if (usdTradeAmount !== 0) {
                const type = usdTradeAmount > 0 ? 'Dolar Alƒ±≈ü' : 'Dolar Satƒ±≈ü';
                const amount = Math.abs(usdTradeAmount);
                state.kur += (usdTradeAmount > 0 ? 0.0005 : -0.0005) * amount; /* Etki azaltƒ±ldƒ± */ // Small impact on kur
                bank.usd += usdTradeAmount;
                addTradeToLog({ time: new Date(), type: type, amount: amount * 1e6, actor: bankName, rate: state.kur, currency: 'USD' });
            }
            if (eurTradeAmount !== 0) {
                const type = eurTradeAmount > 0 ? 'Euro Alƒ±≈ü' : 'Euro Satƒ±≈ü';
                const amount = Math.abs(eurTradeAmount);
                state.euro += (eurTradeAmount > 0 ? 0.0004 : -0.0004) * amount; /* Etki azaltƒ±ldƒ± */ // Small impact on euro
                bank.eur += eurTradeAmount;
                addTradeToLog({ time: new Date(), type: type, amount: amount * 1e6, actor: bankName, rate: state.euro, currency: 'EUR' });
            }
            if (goldTradeAmount !== 0) {
                const type = goldTradeAmount > 0 ? 'Altƒ±n Alƒ±≈ü' : 'Altƒ±n Satƒ±≈ü';
                const amount = Math.abs(goldTradeAmount);
                state.gramAltin += (goldTradeAmount > 0 ? 0.0001 : -0.0001) * amount; /* Etki azaltƒ±ldƒ± */ // Small impact on gold
                bank.gold += goldTradeAmount;
                addTradeToLog({ time: new Date(), type: type, amount: amount, actor: bankName, rate: state.gramAltin, currency: 'GRAM' });
            }
        });
    }

    function simulateDepositorTrading() {
        // Depositors react to inflation, real interest rates, and government credibility
        const realInterestRate = state.faiz - state.enflasyon;
        // USD Trading
        let usdTradeAmount = 0; // Million USD
        if (realInterestRate < -10 && state.kredibilite < 40) { // Very negative real rate, low credibility -> buy USD
            usdTradeAmount = (Math.random() * 1 + 0.2); /* Miktar azaltƒ±ldƒ± */
        } else if (realInterestRate > 5 && state.kredibilite > 60) { // Positive real rate, high credibility -> sell USD
            usdTradeAmount = -(Math.random() * 0.8 + 0.1); /* Miktar azaltƒ±ldƒ± */
        }

        // EUR Trading
        let eurTradeAmount = 0; // Million EUR
        if (realInterestRate < -8 && state.kredibilite < 45) {
            eurTradeAmount = (Math.random() * 0.5 + 0.1); /* Miktar azaltƒ±ldƒ± */
        } else if (realInterestRate > 4 && state.kredibilite > 55) {
            eurTradeAmount = -(Math.random() * 0.4 + 0.05); /* Miktar azaltƒ±ldƒ± */
        }

        // Gold Trading
        let goldTradeAmount = 0; // Grams
        if (state.enflasyon > 70 && realInterestRate < -5) { // High inflation, negative real rate -> buy gold
            goldTradeAmount = (Math.random() * 100 + 20); /* Miktar azaltƒ±ldƒ± */
        } else if (state.enflasyon < 40 && realInterestRate > 3) { // Low inflation, positive real rate -> sell gold
            goldTradeAmount = -(Math.random() * 80 + 10); /* Miktar azaltƒ±ldƒ± */
        }

        // Apply to total depositor positions and affect market
        if (usdTradeAmount !== 0) {
            const type = usdTradeAmount > 0 ? 'Dolar Alƒ±≈ü' : 'Dolar Satƒ±≈ü';
            const amount = Math.abs(usdTradeAmount);
            state.mevduatSahibiDovizPozisyonlari.usd += usdTradeAmount;
            state.kur += (usdTradeAmount > 0 ? 0.001 : -0.001) * amount; /* Etki azaltƒ±ldƒ± */ // Larger impact from public
            addTradeToLog({ time: new Date(), type: type, amount: amount * 1e6, actor: 'Vatanda≈ü', rate: state.kur, currency: 'USD' });
        }
        if (eurTradeAmount !== 0) {
            const type = eurTradeAmount > 0 ? 'Euro Alƒ±≈ü' : 'Euro Satƒ±≈ü';
            const amount = Math.abs(eurTradeAmount);
            state.mevduatSahibiDovizPozisyonlari.eur += eurTradeAmount;
            state.euro += (eurTradeAmount > 0 ? 0.0008 : -0.0008) * amount; /* Etki azaltƒ±ldƒ± */
            addTradeToLog({ time: new Date(), type: type, amount: amount * 1e6, actor: 'Vatanda≈ü', rate: state.euro, currency: 'EUR' });
        }
        if (goldTradeAmount !== 0) {
            const type = goldTradeAmount > 0 ? 'Altƒ±n Alƒ±≈ü' : 'Altƒ±n Satƒ±≈ü';
            const amount = Math.abs(goldTradeAmount);
            state.mevduatSahibiDovizPozisyonlari.gold += goldTradeAmount;
            state.gramAltin += (goldTradeAmount > 0 ? 0.0002 : -0.0002) * amount; /* Etki azaltƒ±ldƒ± */ // Larger impact from public
            addTradeToLog({ time: new Date(), type: type, amount: amount, actor: 'Vatanda≈ü', rate: state.gramAltin, currency: 'GRAM' });
        }
    }


    // --- UI UPDATE ---
    function guncelleUI() {
      if (!isGameRunning) return;
      const updateValue = (elem, value, decimals = 2, suffix = '', isPositiveGood = true, isGold = false) => {
        if (!elem) return;
        const val = parseFloat(value);
        elem.textContent = `${val.toFixed(decimals)}${suffix}`;
        elem.classList.remove('positive', 'negative', 'gold');
        if (val > 0) elem.classList.add(isPositiveGood ? 'positive' : 'negative');
        if (val < 0) elem.classList.add(isPositiveGood ? 'negative' : 'positive');
        if (isGold) elem.classList.add('gold');
      };
      const flashOnChange = (elem, newValue, oldValue, decimals = 2) => {
          if (!elem || newValue.toFixed(decimals) === oldValue.toFixed(decimals)) return;
          const isUp = newValue > oldValue;
          elem.parentElement.classList.remove('flash-green', 'flash-red');
          void elem.parentElement.offsetWidth; // DOM reflow
          elem.parentElement.classList.add(isUp ? 'flash-red' : 'flash-green');
      };
      flashOnChange(el.kurValue, state.kur, lastKur, 4);
      flashOnChange(el.euroValue, state.euro, lastEuro, 4);
      flashOnChange(el.gramAltinValue, state.gramAltin, lastGramAltin, 2);


      updateValue(el.kurValue, state.kur, 4);
      updateValue(el.euroValue, state.euro, 4);
      updateValue(el.rezervValue, state.rezerv, 1, ' Milyar $', true);
      updateValue(el.faizValue, state.faiz, 2, '%', false);
      updateValue(el.enflasyonValue, state.enflasyon, 2, '%', false);
      updateValue(el.beklentiValue, state.enflasyonBeklentisi, 2, '%', false);
      updateValue(el.cdsValue, state.cds, 0, '', false);
      updateValue(el.buyumeValue, state.buyume, 2, '%', true);
      updateValue(el.cariAcikValue, state.cariAcik, 2, '%', true);
      updateValue(el.zkValue, state.zorunluKarsilik, 1, '%', false);
      updateValue(el.krediValue, state.kredibilite, 1, ' Puan', true);
      updateValue(el.guvenValue, state.hukumetGuveni, 1, ' Puan', true);
      el.hukumetGuveniBarInner.style.width = `${state.hukumetGuveni}%`;
      el.ppkCountdown.textContent = state.isPpkDay ? 'KARAR G√úN√ú!' : `${Math.ceil(state.ppkDayCountdown)}sn`;

      // Update new stats
      updateValue(el.nufusValue, state.nufus, 2, ' Milyon');
      updateValue(el.griEkonomiValue, state.griEkonomiOrani, 1, '%', false);
      updateValue(el.dovizTasarrufSeviyesi, state.dovizTasarrufSeviyesi, 1, '%', false);
      updateValue(el.isGucuValue, state.nufus * (state.isGucuKatilimOrani / 100), 2, ' Milyon');
      updateValue(el.netGocValue, state.netGoc, 2, ' Milyon');
      updateValue(el.butceDengesiValue, state.butceDengesiGSYIHOrani, 2, '%', true);
      updateValue(el.talepEndeksiValue, state.talepEndeksi, 1, ' Puan');
      updateValue(el.onsAltinValue, state.onsAltin, 2, ' $', false, true);
      updateValue(el.gramAltinValue, state.gramAltin, 2, ' ‚Ç∫', false, true);
      updateValue(el.ceyrekAltinValue, state.ceyrekAltin, 2, ' ‚Ç∫', false, true);
      updateValue(el.cumhuriyetAltinValue, state.cumhuriyetAltin, 2, ' ‚Ç∫', false, true);
      updateValue(el.yirmiIkiAyarAltinValue, state.yirmiIkiAyarAltin, 2, ' ‚Ç∫', false, true);

      updateValue(el.brentValue, state.brentFiyati, 2, ' $', false);
      updateValue(el.vixValue, state.vixIndex, 2, '', false);
      updateValue(el.benzinValue, state.benzinFiyati, 2, ' ‚Ç∫', false);
      updateValue(el.dizelValue, state.dizelFiyati, 2, ' ‚Ç∫', false);
      updateValue(el.lpgValue, state.lpgFiyati, 2, ' ‚Ç∫', false);
      el.kdvOranValue.textContent = state.kdvOrani.toFixed(1);
      el.gelirVergiOranValue.textContent = state.gelirVergiOrani.toFixed(1);
      el.kurumlarVergiOranValue.textContent = state.kurumlarVergiOrani.toFixed(1);

      // Update Salary/Pension inputs
      el.memurMaasPolis.value = state.memurMaaslari.polis.toFixed(0);
      el.memurMaasAsker.value = state.memurMaaslari.asker.toFixed(0);
      el.memurMaasBelediye.value = state.memurMaaslari.belediye.toFixed(0);
      el.emekliMaasSgk.value = state.emekliMaaslari.sgk.toFixed(0);
      el.emekliMaasBagkur.value = state.emekliMaaslari.bagkur.toFixed(0);
      el.emekliMaasEnDusuk.value = state.emekliMaaslari.enDusuk.toFixed(0);
      // Kripto UI
      CRYPTO_CONFIG.forEach(crypto => {
        const priceEl = document.getElementById(`${crypto.id}-price`);
        const ownedEl = document.getElementById(`${crypto.id}-owned`);
        if(priceEl) priceEl.textContent = `$${state.kriptolar[crypto.id].price.toPrecision(4)}`;
        if(ownedEl) ownedEl.textContent = `${state.kriptolar[crypto.id].amount.toFixed(2)}`;

        // Update crypto chart
        const chart = cryptoCharts[crypto.id];
        if(chart) {
            chart.data.labels = state.kriptolar[crypto.id].history.map(h => h.time);
            chart.data.datasets[0].data = state.kriptolar[crypto.id].history.map(h => h.price);
            chart.update();
        }
      });
      // Main Chart
      dolarGrafik.data.labels = state.zamanGecmisi;
      dolarGrafik.data.datasets[0].data = state.kurGecmisi;
      dolarGrafik.update();
    }

    // --- DYNAMIC EVENTS ---
    function generateNewsEvent() {
      if (!isGameRunning) return;
      const events = [
        { text: "FED BA≈ûKANI'NDAN ≈ûAHƒ∞N A√áIKLAMALAR! Geli≈üen piyasalardan fon √ßƒ±kƒ±≈üƒ± hƒ±zlandƒ±.", effect: () => { state.vixIndex += 5; state.piyasaEtkisi -= 5; }, color: 'red' },
        { text: "T√úRKƒ∞YE'Nƒ∞N KREDƒ∞ NOTU Y√úKSELTƒ∞LDƒ∞! Uluslararasƒ± yatƒ±rƒ±mcƒ±larƒ±n g√ºveni arttƒ±.", effect: () => { state.cds -= 50; state.kredibilite += 5; state.piyasaEtkisi += 10; }, color: 'green' },
        { text: "K√ñRFEZ √úLKELERƒ∞NDEN T√úRKƒ∞YE'YE 50 Mƒ∞LYAR DOLARLIK YATIRIM PAKETƒ∞ A√áIKLANDI!", effect: () => { state.rezerv += 50; state.cds -= 70; state.kur -= 1.5; state.euro -= 1.2; }, color: 'green' },
        { text: "ENERJƒ∞ Fƒ∞YATLARINDA K√úRESEL ≈ûOK! Brent petrol fiyatlarƒ± %15 arttƒ±.", effect: () => { state.brentFiyati *= 1.15; state.enflasyon += 5; }, color: 'red' },
        { text: "AVRUPA MERKEZ BANKASI FAƒ∞Z ƒ∞NDƒ∞RDƒ∞. K√ºresel risk i≈ütahƒ± pozitif.", effect: () => { state.vixIndex -= 3; }, color: 'green' },
        { text: "TURƒ∞ZM GELƒ∞RLERƒ∞ BEKLENTƒ∞LERƒ∞ A≈ûTI! Cari a√ßƒ±ƒüa pozitif katkƒ±.", effect: () => { state.cariAcik += 1.0; state.rezerv += 5; }, color: 'green' },
        { text: "K√úRESEL ALTIN TALEBƒ∞ ARTTI! Ons altƒ±n rekor seviyelere yakla≈üƒ±yor.", effect: () => { state.onsAltin += 50; }, color: 'green' },
        { text: "D√úNYA BANKASI'NDAN T√úRKƒ∞YE EKONOMƒ∞Sƒ∞NE ƒ∞Lƒ∞≈ûKƒ∞N OLUMLU RAPOR!", effect: () => { state.cds -= 30; state.kredibilite += 3; }, color: 'green' },
        { text: "ULUSLARARASI Fƒ∞NANS KURULU≈ûLARI T√úRKƒ∞YE'DEKƒ∞ SERMAYE √áIKI≈ûLARINI ƒ∞ZLƒ∞YOR!", effect: () => { state.cds += 20; state.piyasaEtkisi += 5; }, color: 'red' },
        { text: "B√ñLGESEL GERƒ∞Lƒ∞MLER ARTIYOR! G√ºvenli liman arayƒ±≈üƒ± hƒ±zlandƒ±.", effect: () => { state.vixIndex += 5; state.onsAltin += 30; }, color: 'red' },
        { text: "TARIM SEKT√ñR√úNDE BEKLENENƒ∞N √úZERƒ∞NDE VERƒ∞M! Enflasyona olumlu katkƒ±.", effect: () => { state.enflasyon -= 2; }, color: 'green' },
        { text: "SANAYƒ∞ √úRETƒ∞Mƒ∞NDE KESKƒ∞N D√ú≈û√ú≈û! B√ºy√ºme endi≈üeleri arttƒ±.", effect: () => { state.buyume -= 0.5; state.talepEndeksi -= 3; }, color: 'red' },
        // New events based on user's request
        { text: "B√úY√úK≈ûEHƒ∞R BELEDƒ∞YESƒ∞NDE YOLSUZLUK ƒ∞DDƒ∞ALARI! H√ºk√ºmet g√ºveni sarsƒ±ldƒ±.", effect: () => { state.hukumetGuveni -= 5; state.cds += 10; state.piyasaEtkisi += 3; }, color: 'red' },
        { text: "BELEDƒ∞YE BA≈ûKANI TUTUKLANDI! Siyasi belirsizlik piyasalarƒ± olumsuz etkiliyor.", effect: () => { state.hukumetGuveni -= 10; state.cds += 20; state.kur += 0.5; state.piyasaEtkisi += 5; }, color: 'red' },
        { text: "MUHALEFET PARTƒ∞Sƒ∞ B√úY√úK Mƒ∞Tƒ∞NG D√úZENLEDƒ∞! H√ºk√ºmet √ºzerindeki baskƒ± artƒ±yor.", effect: () => { state.hukumetGuveni -= 3; state.piyasaEtkisi += 2; }, color: 'red' },
        { text: "H√úK√úMETTEN YENƒ∞ EKONOMƒ∞K REFORM PAKETƒ∞! Piyasalardan olumlu tepki.", effect: () => { state.kredibilite += 5; state.hukumetGuveni += 5; state.cds -= 15; state.piyasaEtkisi -= 5; }, color: 'green' },
        { text: "BA≈ûKAN ERDOƒûAN'DAN 'ENFLASYONLA M√úCADELE' VURGUSU! Piyasalara g√ºven mesajƒ±.", effect: () => { state.kredibilite += 3; state.hukumetGuveni += 2; state.enflasyonBeklentisi -= 1; }, color: 'green' },
        { text: "MERKEZ BANKASI'NDAN ≈ûEFFAFLIK ADIMI! Veriler daha sƒ±k a√ßƒ±klanacak.", effect: () => { state.kredibilite += 2; state.cds -= 5; }, color: 'green' },
        { text: "ULUSLARARASI RAPOR: T√úRKƒ∞YE'Nƒ∞N GRƒ∞ EKONOMƒ∞Sƒ∞ K√ú√á√úL√úYOR! Yatƒ±rƒ±mcƒ± ilgisi artƒ±yor.", effect: () => { state.griEkonomiOrani -= 1; state.cds -= 10; }, color: 'green' },
        { text: "YABANCI YATIRIMCI G√ñZ√úYLE T√úRKƒ∞YE: 'D√ñVƒ∞Z KAZANCI FIRSATI VAR!'", effect: () => { state.dovizTasarrufSeviyesi -= 2; state.piyasaEtkisi -= 2; }, color: 'green' },
        { text: "K√úRESEL RESESYON ENDƒ∞≈ûELERƒ∞ ARTIYOR! G√ºvenli liman arayƒ±≈üƒ± hƒ±zlandƒ±.", effect: () => { state.vixIndex += 8; state.onsAltin += 40; state.kur += 0.8; }, color: 'red' },
        { text: "√áƒ∞N EKONOMƒ∞Sƒ∞ BEKLENTƒ∞LERƒ∞ A≈ûTI! K√ºresel b√ºy√ºme beklentileri y√ºkseldi.", effect: () => { state.vixIndex -= 5; state.brentFiyati += 2; state.buyume += 0.1; }, color: 'green' },
      ];
      const randomEvent = events[Math.floor(Math.random() * events.length)];
      randomEvent.effect();
      updateNewsTicker(false, randomEvent.text, randomEvent.color);
    }

    function updateNewsTicker(isInitial = false, customMessage = '', color = '') {
      const defaultNews = [
        "Piyasalar bir sonraki PPK kararƒ±nƒ± bekliyor...",
        "Enflasyon k√ºresel bir sorun olmaya devam ediyor.",
        "Dolar/TL kurundaki volatilite yatƒ±rƒ±mcƒ±larƒ± endi≈üelendiriyor.",
        "H√ºk√ºmet, b√ºy√ºmeyi destekleyici yeni adƒ±mlar planlƒ±yor.",
        "Altƒ±n fiyatlarƒ± k√ºresel geli≈ümelerle y√∂n buluyor.",
        "Euro B√∂lgesi'nden gelen veriler yakƒ±ndan takip ediliyor."
      ];
      let content = '';
      if (customMessage) {
        content = `<span class="news-item-${color}">${customMessage}</span>`;
      } else if (state.publicStatement) {
          // Display public statement in ticker
          let statementSentimentClass = '';
          if (state.publicStatementImpact.fxEffect < 0) statementSentimentClass = 'green';
          else if (state.publicStatementImpact.fxEffect > 0) statementSentimentClass = 'red';
          content = `<span class="news-item-${statementSentimentClass}">BA≈ûKAN A√áIKLAMASI: "${state.publicStatement}"</span>`;
      }
      else {
        content = defaultNews.map(n => `<span>${n}</span>`).join('');
      }
      el.newsContent.innerHTML = content;

      // Animasyonu sƒ±fƒ±rla
      el.newsContent.style.animation = 'none';
      setTimeout(() => {
        el.newsContent.style.animation = '';
      }, 10);
    }

    function generateTweetEvent() {
        if (!isGameRunning) return;
        const users = [
            'Ekonomist101', 'PiyasaKurdu', 'Vatandas_Riza', 'BorsaKaplani', 'AkademikAnaliz',
            'FinansGundemi', 'KriptoSever', 'AltinUzmani', 'EmekliDede', 'MemurBey',
            'EsnafAhmet', 'OgrenciCan', 'DovizAvcisi', 'HaberciAyse', 'AnalizMerkezi',
            'SiyasetAnalizi', 'BelediyeGozcusu', 'HukukcuAli'
        ];
        const tweets = [
            // General economic conditions
            { condition: () => state.enflasyon > 90, text: "Hayat pahalƒ±lƒ±ƒüƒ± canƒ±mƒ±za tak etti! Bu enflasyonla nasƒ±l ge√ßineceƒüiz? #enflasyon #ge√ßimderdi", sentiment: "negative" },
            { condition: () => state.faiz > 50, text: "Y√ºksek faizler y√ºz√ºnden krediye ula≈üamƒ±yoruz, yatƒ±rƒ±mlar durdu. Sanayici kan aƒülƒ±yor! #faiz #ekonomi", sentiment: "negative" },
            { condition: () => state.buyume < 0, text: "√úlke resesyonda, i≈üsizlik artƒ±yor. Ekonomi y√∂netimi nerede? #i≈üsizlik #b√ºy√ºme", sentiment: "negative" },
            { condition: () => state.kredibilite > 60, text: "Merkez Bankasƒ±'nƒ±n kararlƒ± duru≈üu g√ºven veriyor. Enflasyonla m√ºcadele b√∂yle olur. #dolar #kredibilite", sentiment: "positive" },
            { condition: () => state.rezerv > 120, text: "TCMB rezervleri rekor kƒ±rƒ±yor! üí™ Piyasaya g√ºven geldi. #rezerv #g√ºven", sentiment: "positive" },
            { condition: () => true, text: "Dolar/TL'deki hareketliliƒüi yakƒ±ndan izliyoruz. Bakalƒ±m g√ºn sonu ne olacak? #dolarTL #piyasa", sentiment: "neutral" },
            { condition: () => state.cds < 300, text: "CDS primindeki d√º≈ü√º≈ü √ßok olumlu. Yabancƒ± yatƒ±rƒ±mcƒ± i√ßin cazip hale geliyoruz. #CDS #yatƒ±rƒ±m", sentiment: "positive" },
            { condition: () => state.dovizTasarrufSeviyesi > 60, text: "Vatanda≈üƒ±n d√∂vize olan ilgisi bitmiyor. TL'ye g√ºven ne zaman gelecek? #d√∂viz #tasarruf", sentiment: "negative" },
            { condition: () => state.dovizTasarrufSeviyesi < 30, text: "TL'ye d√∂n√º≈ü hƒ±zlandƒ±! Yastƒ±k altƒ±ndaki d√∂vizler bozduruluyor. #TL #ekonomi", sentiment: "positive" },
            { condition: () => state.griEkonomiOrani > 30, text: "Kayƒ±t dƒ±≈üƒ± ekonomi almƒ±≈ü ba≈üƒ±nƒ± gidiyor. Vergi adaletini kim saƒülayacak? #kayƒ±tdƒ±≈üƒ± #vergi", sentiment: "negative" },
            { condition: () => state.griEkonomiOrani < 20, text: "Kayƒ±t dƒ±≈üƒ±yla m√ºcadele meyvelerini veriyor. Vergi gelirleri artacak! #ekonomi #≈üeffaflƒ±k", sentiment: "positive" },

            // Gold specific
            { condition: () => state.onsAltin > 2500, text: "Ons altƒ±n u√ßu≈üta! Gram altƒ±n da pe≈üinden gider mi? #altƒ±n #onsaltƒ±n", sentiment: "positive" },
            { condition: () => state.gramAltin > 4000 && state.enflasyon > 80, text: "Gram altƒ±n yine rekor kƒ±rdƒ±! Enflasyondan korunmanƒ±n tek yolu bu. #gramaltƒ±n #enflasyon", sentiment: "positive" },
            { condition: () => state.gramAltin < 2000 && state.faiz > 60, text: "Faizler y√ºkselince altƒ±n cazibesini yitirdi. Satƒ±≈ü fƒ±rsatƒ± mƒ±?", sentiment: "negative" },

            // Euro specific
            { condition: () => state.euro > 50, text: "Euro da dolara yeti≈üti! Avrupa'dan gelen haberler kurda etkili. #euro #d√∂viz", sentiment: "negative" },
            { condition: () => state.euro < 40, text: "Euro'da geri √ßekilme var. ƒ∞hracat√ßƒ±lar i√ßin avantaj.", sentiment: "positive" },

            // Salary/Pension specific
            { condition: () => state.memurMaaslari.polis > 40000, text: "Polis maa≈ülarƒ±na yapƒ±lan zamlar sevindirici. Emeƒüin kar≈üƒ±lƒ±ƒüƒ± veriliyor! #polis #maa≈ü", sentiment: "positive", user: 'MemurBey' },
            { condition: () => state.memurMaaslari.asker < 35000, text: "Asker maa≈ülarƒ± neden bu kadar d√º≈ü√ºk? Enflasyon kar≈üƒ±sƒ±nda eriyor! #asker #maa≈ü", sentiment: "negative", user: 'Vatandas_Riza' },
            { condition: () => state.emekliMaaslari.enDusuk < 8000, text: "En d√º≈ü√ºk emekli maa≈üƒ± yetersiz! Emekliler zor durumda. #emekli #ge√ßim", sentiment: "negative", user: 'EmekliDede' },
            { condition: () => state.emekliMaaslari.sgk > 12000, text: "SGK emeklilerine m√ºjde! Yapƒ±lan zamlar y√ºzleri g√ºld√ºrd√º. #emekli #zam", sentiment: "positive", user: 'EmekliDede' },

            // Public statement reactions
            { condition: () => state.publicStatementImpact.credibility > 0.5, text: "Ba≈ükan'ƒ±n a√ßƒ±klamalarƒ± piyasaya g√ºven verdi. ƒ∞stikrar sinyalleri geliyor.", sentiment: "positive" },
            { condition: () => state.publicStatementImpact.credibility < -0.5, text: "Ba≈ükan'ƒ±n a√ßƒ±klamalarƒ± kafa karƒ±≈ütƒ±rdƒ±. Piyasalar belirsizlikte.", sentiment: "negative" },
            { condition: () => state.publicStatement.toLowerCase().includes('enflasyon d√º≈üecek') && state.enflasyon > 90, text: "Enflasyon d√º≈üecekmi≈ü... Hadi in≈üallah! Ama market fiyatlarƒ± √∂yle demiyor. ü§î", sentiment: "neutral" },
            { condition: () => state.publicStatement.toLowerCase().includes('d√∂viz satalƒ±m') && state.dovizTasarrufSeviyesi > 50, text: "Ba≈ükan 'd√∂viz satƒ±n' diyor ama bizde yastƒ±k altƒ±nda kalmaya devam eder. G√ºven lazƒ±m g√ºven! #d√∂viz", sentiment: "negative" },
            { condition: () => state.publicStatement.toLowerCase().includes('b√ºy√ºme') && state.buyume > 2, text: "Ba≈ükan b√ºy√ºmeden bahsetti. Evet, rakamlar da bunu destekliyor. #b√ºy√ºme", sentiment: "positive" },
            // New tweets based on user's request
            { condition: () => state.hukumetGuveni < 40, text: "Belediyelerdeki yolsuzluk iddialarƒ± ayyuka √ßƒ±ktƒ±. H√ºk√ºmetin itibarƒ± sarsƒ±lƒ±yor. #yolsuzluk #siyaset", sentiment: "negative", user: 'SiyasetAnalizi' },
            { condition: () => state.hukumetGuveni < 30, text: "Ba≈ükan tutuklamalarƒ± siyasi gerilimi artƒ±rdƒ±. √úlke nereye gidiyor? #siyaset #gerilim", sentiment: "negative", user: 'HukukcuAli' },
            { condition: () => state.hukumetGuveni > 60, text: "H√ºk√ºmetin yeni reformlarƒ± piyasalarƒ± canlandƒ±rdƒ±. G√ºven tazelendi. #reform #ekonomi", sentiment: "positive", user: 'Ekonomist101' },
            { condition: () => state.hukumetGuveni > 70, text: "Belediye mitingleri co≈ükulu ge√ßti. Halkƒ±n desteƒüi tam. #siyaset #halk", sentiment: "positive", user: 'BelediyeGozcusu' },
            { condition: () => state.dovizTasarrufSeviyesi > 70, text: "Yastƒ±k altƒ± d√∂vizler rekor kƒ±rdƒ±. T√ºrk Lirasƒ±'na g√ºven azaldƒ±k√ßa d√∂vize ka√ßƒ±≈ü hƒ±zlanƒ±yor. #d√∂viz #TL", sentiment: "negative", user: 'DovizAvcisi' },
            { condition: () => state.dovizTasarrufSeviyesi < 30, text: "Dolarizasyon tersine d√∂nd√º! Vatanda≈ülar TL'ye g√ºveniyor, d√∂vizlerini bozduruyor. #dolarizasyon #TL", sentiment: "positive", user: 'PiyasaKurdu' },
        ];

        const possibleTweets = tweets.filter(t => t.condition());
        if (possibleTweets.length > 0) {
            const tweet = possibleTweets[Math.floor(Math.random() * possibleTweets.length)];
            addTweetToFeed({
                user: tweet.user || users[Math.floor(Math.random() * users.length)],
                text: tweet.text,
                sentiment: tweet.sentiment
            });
        }
    }

    // --- SCENARIO SELECTION ---
    function selectScenario(scenarioName) {
      if (isGameRunning) return;
      state = JSON.parse(JSON.stringify(scenarios[scenarioName])); // Deep copy
      state.difficulty = parseFloat(el.difficulty.value);
      const now = new Date();
      state.zamanGecmisi = [now];
      state.kurGecmisi = [state.kur];

       for (const cryptoId in state.kriptolar) {
            state.kriptolar[cryptoId].history = [{ time: now, price: state.kriptolar[cryptoId].price }];
        }

      isGameRunning = true;
      closeModal('scenarioModal');
      initAudio();
      startGame();
    }
  </script>
</body>
</html>
